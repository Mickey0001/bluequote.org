var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,C,A){e instanceof String&&(e=String(e));for(var b=e.length,x=0;x<b;x++){var a=e[x];if(C.call(A,a,x,e))return{i:x,v:a}}return{i:-1,v:void 0}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,C,A){e!=Array.prototype&&e!=Object.prototype&&(e[C]=A.value)};$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,C,A,b){if(C){A=$jscomp.global;e=e.split(".");for(b=0;b<e.length-1;b++){var x=e[b];x in A||(A[x]={});A=A[x]}e=e[e.length-1];b=A[e];C=C(b);C!=b&&null!=C&&$jscomp.defineProperty(A,e,{configurable:!0,writable:!0,value:C})}};$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(e,A){return $jscomp.findInternal(this,e,A).v}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var e=$jscomp.global.Symbol.iterator;e||(e=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[e]&&$jscomp.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(e){var C=0;return $jscomp.iteratorPrototype(function(){return C<e.length?{done:!1,value:e[C++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(e){$jscomp.initSymbolIterator();e={next:e};e[$jscomp.global.Symbol.iterator]=function(){return this};return e};$jscomp.iteratorFromArray=function(e,C){$jscomp.initSymbolIterator();e instanceof String&&(e+="");var A=0,b={next:function(){if(A<e.length){var x=A++;return{value:C(x,e[x]),done:!1}}b.next=function(){return{done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};
$jscomp.polyfill("Array.prototype.keys",function(e){return e?e:function(){return $jscomp.iteratorFromArray(this,function(e){return e})}},"es6-impl","es3");window.themifybuilderapp=window.themifybuilderapp||{};
(function(e){var C=e.ui.sortable.prototype._mouseStart,A=e("body").hasClass("full-section-scrolling");e.ui.sortable.prototype._mouseStart=function(a,c,b){this._trigger("beforeStart",a,this._uiHash());C.apply(this,[a,c,b])};void 0===e.fn.themifySerializeObject&&(e.fn.themifySerializeObject=function(){for(var a={},c=0,b=this.length;c<b;++c){var f=this[c].type;if(e(this[c]).hasClass("wp-editor-area")&&void 0!==tinyMCE){var g=tinyMCE.get(this[c].id);g&&(this[c].value=g.getContent())}if(""!==this[c].value&&
this[c].name&&("text"===f||"radio"===f||"checkbox"===f||"textarea"===f||"select-one"===f||"hidden"===f||"email"===f||"select"===f||"select-multiple"===f)){var g=this[c].name,h=this[c].value;"select-multiple"===f&&(h=jQuery(this[c]).val());if("radio"===f||"checkbox"===f)h=this[c].checked&&h;void 0!==a[g]?(!a[g].push&&(a[g]=[a[g]]),h&&a[g].push(h)):h&&(a[g]=h)}}return a});var b=themifybuilderapp={activeModel:null,Models:{},Collections:{},Mixins:{},Views:{Modules:{},Rows:{},SubRows:{},Columns:{},Controls:{}},
Forms:{},Utils:{},Instances:{Builder:{}},cache:{repeaterElements:{}}},x=[];b.autoSaveCid=null;b.hasChanged=null;b.editing=!1;b.init=!1;b.scrollTo=!1;b.eventName=!1;b.beforeEvent=!1;b.saving=!1;b.rowStyling=[];b.saveCid=!1;b.activeBreakPoint="desktop";b.zoomMeta={isActive:!1,size:100};b.isPreview=!1;b.isComponentSaved=[];b.Models.Module=Backbone.Model.extend({defaults:{elType:"module",mod_name:"",mod_settings:{}},initialize:function(){b.Models.Registry.register(this.cid,this)},toRenderData:function(){return{slug:this.get("mod_name"),
name:this.get("mod_name"),excerpt:this.getExcerpt()}},getExcerpt:function(a){a=a||this.get("mod_settings");return this.limitString(a.content_text||a.content_box||a.plain_text||"",100)},limitString:function(a,c){var b="";""!==a&&(a=this.stripHtml(a).toString(),b=a.length>c?a.substr(0,c):a);return b},stripHtml:function(a){var c=document.createElement("div");c.innerHTML=a;return c.textContent||c.innerText||""},setData:function(a){a=b.Views.init_module(a,b.mode);a.model.trigger("custom:change",a)},backendLivePreview:function(){e(".tb_element_cid_"+
this.cid).find(".module_excerpt").text(this.getExcerpt(x))},getPreviewSettings:function(){return _.extend({cid:this.cid},themifyBuilder.modules[this.get("mod_name")].defaults,x)}});b.Models.SubRow=Backbone.Model.extend({defaults:{elType:"subrow",row_order:0,gutter:"gutter-default",column_alignment:"col_align_top",background_video:"",mutevideo:"",unloopvideo:"",desktop_dir:"ltr",tablet_dir:"ltr",tablet_landscape_dir:"ltr",mobile_dir:"ltr",col_mobile:"-auto",col_tablet_landscape:"-auto",col_tablet:"-auto",
cols:{},styling:{}},initialize:function(){b.Models.Registry.register(this.cid,this)},setData:function(a){a=b.Views.init_subrow(a,b.mode);a.model.trigger("custom:change",a)}});b.Models.Column=Backbone.Model.extend({defaults:{elType:"column",column_order:"",grid_class:"",component_name:"column",background_video:"",mutevideo:"",unloopvideo:"",modules:{},styling:{}},initialize:function(){b.Models.Registry.register(this.cid,this)},setData:function(a){a=b.Views.init_column(a,b.mode);a.model.trigger("custom:change",
a)}});b.Models.Row=Backbone.Model.extend({defaults:{elType:"row",row_order:0,gutter:"gutter-default",column_alignment:A?"col_align_middle":"col_align_top",desktop_dir:"ltr",tablet_dir:"ltr",tablet_landscape_dir:"ltr",mobile_dir:"ltr",col_mobile:"-auto",col_tablet_landscape:"-auto",col_tablet:"-auto",background_video:"",mutevideo:"",unloopvideo:"",cols:{},styling:{}},initialize:function(){b.Models.Registry.register(this.cid,this)},setData:function(a){a=b.Views.init_row(a,b.mode);a.model.trigger("custom:change",
a)}});b.Collections.Rows=Backbone.Collection.extend({model:b.Models.Row});b.Models.Registry={items:{},register:function(a,c){this.items[a]=c},lookup:function(a){return this.items[a]||null},remove:function(a){delete this.items[a]},destroy:function(){_.each(this.items,function(a,c){a.destroy()});this.items={};console.log("destroy registry")}};b.Models.setValue=function(a,c,d){d=d||!1;b.Models.Registry.lookup(a).set(c,{silent:d})};b.vent=_.extend({},Backbone.Events);b.Views.register_module=function(a,
c){"default"!==a&&(this.Modules[a]=this.Modules["default"].extend(c))};b.Views.init_module=function(a,c){if(void 0===themifyBuilder.modules[a.mod_name])return!1;c=c||"default";void 0===a.mod_settings&&void 0!==themifyBuilder.modules[a.mod_name].defaults&&(a.mod_settings=_.extend({},themifyBuilder.modules[a.mod_name].defaults));var d=a instanceof b.Models.Module?a:new b.Models.Module(a),f=new (this.get_module(c))({model:d,type:c});return{model:d,view:f}};b.Views.get_module=function(a){a=a||"default";
return this.module_exists(a)?this.Modules[a]:this.Modules["default"]};b.Views.unregister_module=function(a){"default"!==a&&this.module_exists(a)&&delete this.Modules[a]};b.Views.module_exists=function(a){return this.Modules.hasOwnProperty(a)};b.Views.register_column=function(a,c){"default"!==a&&(this.Columns[a]=this.Columns["default"].extend(c))};b.Views.init_column=function(a,c){c=c||"default";var d=a instanceof b.Models.Column?a:new b.Models.Column(a),f=new (this.get_column(c))({model:d,type:c});
return{model:d,view:f}};b.Views.get_column=function(a){a=a||"default";return this.column_exists(a)?this.Columns[a]:this.Columns["default"]};b.Views.unregister_column=function(a){"default"!==a&&this.column_exists(a)&&delete this.Columns[a]};b.Views.column_exists=function(a){return this.Columns.hasOwnProperty(a)};b.Views.register_subrow=function(a,c){"default"!==a&&(this.SubRows[a]=this.SubRows["default"].extend(c))};b.Views.init_subrow=function(a,c){c=c||"default";var d=a instanceof b.Models.SubRow?
a:new b.Models.SubRow(a),f=new (this.get_subrow(c))({model:d,type:c});return{model:d,view:f}};b.Views.get_subrow=function(a){a=a||"default";return this.subrow_exists(a)?this.SubRows[a]:this.SubRows["default"]};b.Views.unregister_subrow=function(a){"default"!==a&&this.subrow_exists(a)&&delete this.SubRows[a]};b.Views.subrow_exists=function(a){return this.SubRows.hasOwnProperty(a)};b.Views.register_row=function(a,c){"default"!==a&&(this.Rows[a]=this.Rows["default"].extend(c))};b.Views.init_row=function(a,
c){var d=a.attributes;if(void 0===d||void 0!==d.cols&&(0<Object.keys(d.cols)||0<d.cols.length)||void 0!==d.styling&&0<Object.keys(d.styling).length){c=c||"default";var d=a instanceof b.Models.Row?a:new b.Models.Row(a),f=new (this.get_row(c))({model:d,type:c});return{model:d,view:f}}return!1};b.Views.get_row=function(a){a=a||"default";return this.row_exists(a)?this.Rows[a]:this.Rows["default"]};b.Views.unregister_row=function(a){"default"!==a&&this.row_exists(a)&&delete this.Rows[a]};b.Views.row_exists=
function(a){return this.Rows.hasOwnProperty(a)};b.Views.BaseElement=Backbone.View.extend({type:"default",events:{"click .themify_builder_copy_component":"copy","click .themify_builder_paste_component":"paste","click .themify_builder_import_component":"import","click .themify_builder_export_component":"export","click .themify_duplicate":"duplicate","click .themify_delete":"delete"},initialize:function(a){_.extend(this,_.pick(a,"type"));this.listenTo(this.model,"custom:change",this.modelChange);this.listenTo(this.model,
"destroy",this.remove)},modelChange:function(){this.$el.attr(_.extend({},_.result(this,"attributes")));var a=this.render(),c=this.model.get("elType"),d=b.beforeEvent.data("cid");e(".tb_element_cid_"+d).replaceWith(a.el);"visual"===b.mode?("subrow"!==c&&b.Mixins.Builder.initGridMenu(a.el,"module"!==c),this.model.trigger("visual:change")):("row"===b.eventName&&(d=this.$el.data("cid")),b.vent.trigger("dom:change",d,b.beforeEvent,this.$el,b.eventName),b.Mixins.Builder.update(this.$el),"row"===b.eventName&&
b.vent.trigger("dom:builder:change"))},remove:function(){this.$el.remove()},copy:function(a){a.preventDefault();a.stopPropagation();var c=e(a.currentTarget);a=ThemifyBuilderCommon.detectBuilderComponent(c);switch(a){case "row":case "subrow":var b=c.closest(".module_"+a);break;case "module":b=c.closest(".active_module");break;case "column":case "sub-column":b=c.closest(".module_column")}b=this.getData(b,a);"sub-column"===a&&(b.component_name=a);ThemifyBuilderCommon.Clipboard.set(a,b)},paste:function(a){a.preventDefault();
a.stopPropagation();var c=e(a.currentTarget),d=ThemifyBuilderCommon.detectBuilderComponent(c);a=ThemifyBuilderCommon.Clipboard.get(d);if(!1===a)ThemifyBuilderCommon.alertWrongPaste();else if(ThemifyBuilderCommon.confirmDataPaste()){var c=c.closest("[data-cid]"),f=b.Models.Registry.lookup(c.data("cid"));b.eventName="row";if("column"===d||"sub-column"===d)a.grid_class=b.Utils.filterClass(c.prop("class")),c.hasClass("first")?a.grid_class+=" first":c.hasClass("last")&&(a.grid_class+=" last"),(d=c[0].style.width)?
a.grid_width=d.replace("%",""):delete a.grid_width;b.beforeEvent=ThemifyBuilderCommon.Lightbox.clone(c);f.setData(a)}},"import":function(a){a.preventDefault();a.stopPropagation();a=e(a.currentTarget);var c=ThemifyBuilderCommon.detectBuilderComponent(a),d=a.closest("[data-cid]"),f=b.Models.Registry.lookup(d.data("cid")),g={data:{action:"tb_component_data",component:c,type:"import"}};if("column"===c||"sub-column"===c){var h=a.closest(".module_column");var k=h.closest("column"===c?".module_row":".module_subrow").index();
g.data.indexData={row:k,col:h.index()}}ThemifyBuilderCommon.Lightbox.open(g,null,function(){var a=this.$lightbox;a.find("#builder_submit_import_component_form").on("click",function(g){g.preventDefault();g=a.find("#tb_data_field");g=JSON.parse(g.val());if("column"===c&&"sub-column"===g.component_name||"sub-column"===c&&"column"===g.component_name)g.component_name=c;if(void 0===g.component_name||g.component_name!==c)ThemifyBuilderCommon.alertWrongPaste();else{g=b.Utils.clear(g,!0);if("column"===c||
"sub-column"===c)g.column_order=h.index(),g.grid_class=h.prop("class"),"column"===c?g.row_order=k:(g.sub_row_order=k,g.row_order=h.closest(".module_row").index(),g.col_order=h.parents(".module_column").index());b.eventName="row";b.beforeEvent=ThemifyBuilderCommon.Lightbox.clone(d);f.setData(g);ThemifyBuilderCommon.Lightbox.close()}})})},getData:function(a,c){var d={};var f=c||ThemifyBuilderCommon.detectBuilderComponent(a);switch(f){case "row":case "subrow":var g=a.closest(".module_"+f);var e=g.index();
d=b.Utils._getRowSettings(g[0],e,f);break;case "module":d=b.Models.Registry.lookup(a.closest(".active_module").data("cid")).attributes;d=b.Utils.clear(d,!0);break;case "column":case "sub-column":d=a.closest(".module_column"),g=d.closest("column"===f?".module_row":".module_subrow"),e=g.index(),f=b.Utils._getRowSettings(g[0],e,"column"===f?"row":"subrow"),d=f.cols[d.index()]}return d},"export":function(a){a.preventDefault();a.stopPropagation();var c=e(a.currentTarget);a=ThemifyBuilderCommon.detectBuilderComponent(c);
var b=this.getData(c,a),c={data:{action:"tb_component_data",component:a,type:"export"}};b.component_name=a;b=JSON.stringify(b);ThemifyBuilderCommon.Lightbox.open(c,null,function(){this.$lightbox.find("#tb_data_field").val(b).on("click",function(){e(this).trigger("focus").trigger("select")})})},duplicate:function(a){a.preventDefault();a.stopPropagation();a=e(a.currentTarget).closest("[data-cid]");var c=ThemifyBuilderCommon.Lightbox.clone(a),d=b.Models.Registry.lookup(c.data("cid"));a.removeClass("tb_element_cid_"+
d.cid);c.hide().insertAfter(a);var f=this.getData(c,d.get("elType"));b.eventName="duplicate";b.beforeEvent=c;d.setData(f);a.addClass("tb_element_cid_"+d.cid)},editComponent:function(){b.hasChanged=!1;if(b.autoSaveCid!==b.activeModel.cid){var a=b.activeModel.get("elType"),c="module"===a?b.activeModel.get("mod_name"):a;ThemifyBuilderCommon.Lightbox.open({loadMethod:"inline",templateID:"builder_form_"+c},function(c){b.Mixins.Common.editComponentCallback(c,a,!1,!1)},function(c){c=ThemifyBuilderCommon.Lightbox.$lightbox;
b.activeModel.get("styleClicked")?c.find('a[href="#themify_builder_options_styling"]').trigger("click"):b.activeModel.get("visibileClicked")?c.find('a[href="#themify_builder_options_visibility"]').trigger("click"):new SimpleBar(c.find("#"+("column"===a||"subrow"===a?"themify_builder_options_styling":"themify_builder_options_setting"))[0]);b.autoSaveCid=b.activeModel.cid})}},"delete":function(a){a.preventDefault();a.stopPropagation();a=e(a.currentTarget);var c=ThemifyBuilderCommon.detectBuilderComponent(a);
if(confirm(themifyBuilder.i18n[c+"DeleteConfirm"])){var d=a.closest("[data-cid]");a=d.data("cid");if(c=b.Models.Registry.lookup(a)){var d=d.closest(".module_row"),f="row",g="",h={};"row"===c.get("elType")?(h.pos_cid=d.next(".module_row"),h.pos="before",0===h.pos_cid.length&&(h.pos="after",h.pos_cid=d.prev(".module_row")),f="delete_row",h.pos_cid=h.pos_cid.data("cid")):a=d.data("cid");d=ThemifyBuilderCommon.Lightbox.clone(d);c.destroy();"row"!==c.get("elType")?g=e(".tb_element_cid_"+a):b.vent.trigger("dom:builder:change");
b.vent.trigger("dom:change",a,d,g,f,h)}}}});b.Views.BaseElement.extend=function(a){var c=this,b=Backbone.View.extend.apply(this,arguments);b.prototype.events=_.extend({},this.prototype.events,a.events);b.prototype.initialize=function(){_.isFunction(c.prototype.initialize)&&c.prototype.initialize.apply(this,arguments);_.isFunction(a.initialize)&&a.initialize.apply(this,arguments)};return b};b.Views.Modules["default"]=b.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_module module-"+
this.model.get("mod_name")+" active_module tb_element_cid_"+this.model.cid,"data-cid":this.model.cid}},template:wp.template("builder_module_item"),events:{dblclick:"edit","click .themify_module_options":"edit","click .themify_builder_module_styling":"edit","click .tb_visibility_component ":"edit"},initialize:function(){this.listenTo(this,"edit",this.edit);this.listenTo(this.model,"dom:module:unsaved",this.removeUnsaved);this.listenTo(this.model,"change:view",this.setView)},removeUnsaved:function(){this.model.destroy()},
render:function(){this.el.innerHTML=this.template(this.model.toRenderData());return this},setView:function(a){this.setElement(a)},edit:function(a){if(b.isPreview)return!0;null!==a&&(a.preventDefault(),a.stopPropagation(),a.currentTarget.classList.contains("themify_builder_module_styling")?this.model.set({styleClicked:!0},{silent:!0}):a.currentTarget.classList.contains("tb_visibility_component")&&this.model.set({visibileClicked:!0},{silent:!0}));b.activeModel&&void 0!==b.activeModel.get("is_new")&&
b.activeModel.unset("is_new",{silent:!0});this.model.cid!==b.autoSaveCid&&null!==b.autoSaveCid&&b.Forms.saveComponent(null);b.activeModel=this.model;this.editComponent()}});b.Views.Columns["default"]=b.Views.BaseElement.extend({tagName:"div",attributes:function(){var a="column"===this.model.get("component_name")?"":" sub_column",a={"class":"module_column tb-column tb_element_cid_"+this.model.cid+" "+this.model.get("grid_class")+a,"data-cid":this.model.cid};this.model.get("grid_width")&&(a.style="width:"+
this.model.get("grid_width")+"%");return a},template:wp.template("builder_column_item"),events:{"click .themify_builder_option_column":"edit","click .js-tb_empty_row_btn":"showModPanel"},initialize:function(){this.listenTo(this.model,"change:view",this.setView)},render:function(a){this.el.innerHTML=this.template({component_name:this.model.get("component_name")});var c=this.model.get("modules");!b.id&&b.saveCid&&(b.rowStyling[this.model.cid]=1);if(c){var d=document.createDocumentFragment(),f;for(f in c)if(void 0!==
c[f]&&null!==c[f]){var g=c[f],e=a?a+"-"+f:!1,k=void 0===g.cols?b.Views.init_module(g,this.type):b.Views.init_subrow(g,this.type);if(k){var l=k.view.render(e);b.id&&g.mod_name?(b.VisualCache[k.model.cid]=g.mod_name+"-"+b.id+"-"+e,l.$el.children(".module")[0].className+=" "+b.VisualCache[k.model.cid]):!b.id&&b.saveCid&&(b.rowStyling[k.model.cid]=1);d.appendChild(l.el)}}this.el.getElementsByClassName("themify_module_holder")[0].appendChild(d)}return this},edit:function(a){a.preventDefault();a.stopPropagation();
this.model.cid!==b.autoSaveCid&&null!==b.autoSaveCid&&b.Forms.saveComponent(null);b.activeModel=this.model;this.editComponent()},setView:function(a){this.setElement(a)},showModPanel:function(a){a.preventDefault();b.toolbar.Panel.show()}});b.Views.SubRows["default"]=b.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_sub_row module_subrow active_module clearfix tb_element_cid_"+this.model.cid,"data-cid":this.model.cid}},template:wp.template("builder_subrow_item"),
events:{"click .themify_builder_style_subrow":"edit"},initialize:function(){this.listenTo(this.model,"change:view",this.setView)},render:function(a){var c=this.model.get("cols"),d=Object.keys(c).length;this.el.innerHTML=this.template();b.id&&(b.VisualCache[this.model.cid]="sub_row_"+a,this.el.className+=" "+b.VisualCache[this.model.cid]);if(0<d){for(var f=document.createDocumentFragment(),g=0;g<=d;++g)if(void 0!==c[g]){c[g].component_name="sub-column";var e=a+"-"+g,k=b.Views.init_column(c[g],this.type),
l=k.view.render("sub_row_"+e).el;b.id&&(b.VisualCache[k.model.cid]="sub_column_post_"+b.id+" sub_column_"+e,l.className+=" "+b.VisualCache[k.model.cid]);f.appendChild(l)}this.el.getElementsByClassName("subrow_inner")[0].appendChild(f)}b.init&&!b.id&&b.Utils.selectedGridMenu(this.el);return this},setView:function(a){this.setElement(a)},edit:function(a){a.stopPropagation();a.preventDefault();this.model.cid!==b.autoSaveCid&&null!==b.autoSaveCid&&b.Forms.saveComponent(null);b.activeModel=this.model;this.editComponent()}});
b.Views.Rows["default"]=b.Views.BaseElement.extend({tagName:"div",attributes:function(){return{"class":"themify_builder_row module_row clearfix tb_element_cid_"+this.model.cid,"data-cid":this.model.cid}},template:wp.template("builder_row_item"),events:{"click .themify_builder_option_row":"edit","click .themify_builder_style_row":"edit","click .tb_visibility_component ":"edit","click .themify_builder_grid_list li a":"_gridMenuClicked","click .themify_builder_grid_list_wrapper .grid_tabs li a":"_switchGridTabs",
"click .themify_builder_column_alignment li a":"_columnAlignmentMenuClicked","click .themify_builder_column_direction li a":"_columnDirectionMenuClicked","change .gutter_select":"_gutterChange","click .toggle_row":"toggleRow","click .themify_builder_toggle_row":"toggleRow"},initialize:function(){this.listenTo(this.model,"change:view",this.setView)},render:function(a){var c=this.model.get("cols"),d=Object.keys(c).length;this.el.innerHTML=this.template();b.saveCid&&(b.rowStyling[this.model.cid]=1);
if(0<d){for(var f=document.createDocumentFragment(),g,e=!1,k=0;k<=d;++k)if(void 0!==c[k]){c[k].component_name="column";var l=b.Views.init_column(c[k],this.type);b.id&&(g=l.model.get("column_order"),void 0===g&&(g=k),e=a+"-"+g);var m=l.view.render(e).el;b.id&&(b.VisualCache[l.model.cid]="module_column_"+g+" tb_"+b.id+"_column",m.className+=" "+b.VisualCache[l.model.cid]);f.appendChild(m)}this.el.getElementsByClassName("row_inner")[0].appendChild(f)}else b.Utils._addNewColumn({newclass:"col-full",component:"column",
type:this.type},this.$el.find(".row_inner"));b.Utils.selectedGridMenu(this.el);return this},edit:function(a){a.stopPropagation();a.preventDefault();a.currentTarget.classList.contains("themify_builder_style_row")?this.model.set({styleClicked:!0},{silent:!0}):a.currentTarget.classList.contains("tb_visibility_component")&&this.model.set({visibileClicked:!0},{silent:!0});this.model.cid!==b.autoSaveCid&&null!==b.autoSaveCid&&b.Forms.saveComponent(null);b.activeModel=this.model;this.editComponent()},_switchGridTabs:function(a){b.scrollTo=
e(a.currentTarget).closest("[data-cid]");b.Forms.lightbox_switcher(a)},_gridMenuClicked:function(a){a.preventDefault();a=e(a.currentTarget);var c=a.data("grid"),d=a.data("handle"),f=!1,g=a.data("type"),h="desktop"===g,k=ThemifyBuilderCommon.Lightbox.clone(a.closest(".module_row"));a.parent().addClass("selected").siblings().removeClass("selected");if("module"===d){if("-full"!==c[0]){f=!0;var l=b.Views.init_subrow({cols:[{grid_class:"col-full"}]},b.mode);var m=a.closest(".active_module"),r=m.clone();
r.insertAfter(m);var p=l.view.render().$el.find(".themify_module_holder").prepend(m).end().insertAfter(r).find("."+a.attr("class").replace(" ",".")).closest("li").addClass("selected").siblings().removeClass("selected").end().end().end().find(".subrow_inner");r.remove();l=p.closest(".module_subrow")}}else f="subrow"===d,l=a.closest(".module_"+d),p=l.find("."+d+"_inner").first();if(0!==p.length){if(h||"module"===d){g=p;var w=a.data("col");g=g.add(l);void 0===w&&(w=1,a.data("col",w));g.removeClass("col-count-1 col-count-"+
p.attr("data-basecol")).addClass("col-count-"+w);p.attr("data-basecol",w);h&&a.closest(".themify_builder_grid_list_wrapper").find(".themify_builder_grid_reposnive .themify_builder_grid_list").each(function(){var a=e(this).find(".selected"),c=a.find("a"),b=c.data("type"),c=c.data("col");void 0!==c&&(c>w||4===w&&3===c||4<=w&&4<=c&&w!=c)&&(a.removeClass("selected"),p.removeClass("tb_grid_classes col-count-"+p.attr("data-basecol")+" "+p.attr("data-col_"+b)).attr("data-col_"+b,""),e(this).closest(".themify_builder_grid_list").find("."+
b+"-auto").parent().addClass("selected"))})}else return"-auto"!==c[0]?(k="column"+c.join("-"),w=a.data("col"),3===w&&p.attr("data-basecol")>w&&(k+=" tb_3col"),p.removeClass(p.attr("data-col_tablet")+" "+p.attr("data-col_tablet_landscape")+" "+p.attr("data-col_mobile")).addClass(k+" tb_grid_classes col-count-"+p.attr("data-basecol")).attr("data-col_"+g,k)):p.removeClass("tb_grid_classes tb_3col col-count-"+p.attr("data-basecol")+" "+p.attr("data-col_"+g)).attr("data-col_"+g,""),"visual"===b.mode&&
e("body",top_iframe).height(document.body.scrollHeight),b.Utils.setCompactMode(p.children(".module_column")),!1;g=p.children(".module_column");h=c.length;d="module_column"+(f?" sub_column":"")+" col";for(l=0;l<h;++l)m=g.eq(l),0<m.length?m.removeClass(b.Utils.gridClass.join(" ")).addClass(d+c[l]):b.Utils._addNewColumn({newclass:d+c[l],component:f?"sub-column":"column",type:b.mode},p);h<p.children().length&&p.children(".module_column").eq(h-1).nextAll().each(function(){e(this).find(".themify_module_holder").first().children().appendTo(e(this).prev().find(".themify_module_holder").first());
e(this).remove()});g=p.children();g.removeClass("first last");p.hasClass("direction-rtl")?(g.last().addClass("first"),g.first().addClass("last")):(g.first().addClass("first"),g.last().addClass("last"));f&&"-full"===c[0]&&(c=p.closest(".module_subrow"),f=c.closest(".module_column"),g=p.find(".active_module"),g.insertAfter(c),c.remove(),b.Mixins.Builder.initGridMenu(f[0],!0),g.find(".themify_builder_grid_list .grid-layout--full").parent().addClass("selected").siblings().removeClass("selected"));b.Utils.columnDrag(p,
!0);l=a.closest(".module_row");b.Mixins.Builder.columnSort(l);b.Mixins.Builder.updateModuleSort(l);b.vent.trigger("dom:change",l.data("cid"),k,l,"row")}},_columnAlignmentMenuClicked:function(a){a.preventDefault();a=e(a.currentTarget);var c=a.data("handle");if("module"!==c&&!a.closest("li").hasClass("selected")){a.closest("li").addClass("selected").siblings("li").removeClass("selected");var d=a.closest(".module_"+c);var f=a.data("alignment"),g=b.Models.Registry.lookup(d.data("cid")),h=ThemifyBuilderCommon.Lightbox.clone(d);
d.find("."+c+"_inner").first().removeClass(g.get("column_alignment")).addClass(f);g.set({column_alignment:f},{silent:!0});b.vent.trigger("dom:change",h.data("cid"),h,a.closest(".module_"+c),"row")}},_columnDirectionMenuClicked:function(a){a.preventDefault();var c=e(a.currentTarget),d=c.data("handle");a=c.data("dir");if("module"!==d&&!c.closest("li").hasClass("selected")){c.closest("li").addClass("selected").siblings("li").removeClass("selected");var c=c.closest(".module_"+d),d=c.find("."+d+"_inner").first(),
f=d.children(".module_column"),c=f.first(),f=f.last();"rtl"===a?(c.removeClass("first").addClass("last"),f.removeClass("last").addClass("first"),d.addClass("direction-rtl")):(c.removeClass("last").addClass("first"),f.removeClass("first").addClass("last"),d.removeClass("direction-rtl"));d.attr("data-"+b.activeBreakPoint+"_dir",a)}},_gutterChange:function(a){a=e(a.currentTarget);var c=a.data("handle");if("module"!==c){var d=a.val();a.find("option").removeAttr("selected").filter('[value="'+d+'"]').attr("selected",
"selected");var f=a.closest(".module_"+c),g=ThemifyBuilderCommon.Lightbox.clone(f),h=f.find("."+c+"_inner").first(),k=b.Models.Registry.lookup(f.data("cid"));g.find(".themify_builder_"+c+"_top .gutter_select").val(f.data("gutter"));b.Utils.columnDrag(h,!1,k.get("gutter"),d);h.removeClass(k.get("gutter")).addClass(d);k.set({gutter:d},{silent:!0});b.vent.trigger("dom:change",g.data("cid"),g,a.closest(".module_"+c),"row")}},setView:function(a){this.setElement(a)},toggleRow:function(a){a.preventDefault();
a.stopPropagation();var c=e(a.currentTarget).closest(".module_row");c.find(".row_inner").first().slideToggle("fast",function(){c.toggleClass("collapsed")})}});b.Views.Builder=Backbone.View.extend({type:"default",events:{"click .tb-import-layout-button":"importLayoutButton"},initialize:function(a){_.extend(this,_.pick(a,"type"));b.vent.on("dom:builder:change",this.tempEvents.bind(this));b.vent.on("dom:builder:init",this.init.bind(this))},init:function(a){b.Forms.getFormTemplates();b.init=a;this.rowSort();
this.initGridMenu(this.el,!0);"visual"===b.mode?(this.updateModuleSort(this.$el),a&&this.initModuleVisualDrag(),setTimeout(function(){b.Utils._onResize(!0)},1500)):(a&&this.initModuleDraggable(b.toolbar.$el),this.updateModuleSort(e("body")));var c=this;setTimeout(function(){b.Utils.setCompactMode(c.el.getElementsByClassName("module_column"))},1E3);b.vent.trigger("dom:builder:change");this.insertLayoutButton();b.init=!0},render:function(){for(var a=document.createDocumentFragment(),c=this.collection,
d=!1,f=0,g=c.length;f<g;++f){var e=b.Views.init_row(c.models[f],this.type);if(!1!==e){b.id&&(d=e.model.get("row_order"),void 0===d&&(d=f));var k=e.view.render(d).el;b.id&&(b.VisualCache[e.model.cid]="themify_builder_"+b.id+"_row module_row_"+d,k.className+=" "+b.VisualCache[e.model.cid]);a.appendChild(k)}}this.el.appendChild(a);b.Utils.columnDrag(!1,!1);return this},tempEvents:function(){this.newRowAvailable()},insertLayoutButton:function(){this.$el.find(".tb-import-layout-button").remove();2>this.$(".module_row").length&&
this.el.insertAdjacentHTML("beforeend",'<a href="#" class="tb-import-layout-button'+(themifyBuilder.is_premium?"":" themify_builder_lite")+'">'+themifyBuilder.i18n.text_import_layout_button+"</a>")},importLayoutButton:function(a){a.preventDefault();b.Views.Toolbar.prototype.loadLayout(a)}});b.Mixins.Common={styleData:{},doTheBinding:function(a,c,d){var f=!1,g=!1,h=a.data("binding"),k="desktop"!==b.activeBreakPoint;c||void 0===h.empty?c&&void 0!==h[c]?f="radio"===a.attr("type")?a.is(":checked")?h[c]:
!1:h[c]:c&&void 0!==h.not_empty?f=h.not_empty:void 0!==h.select&&c!==h.select.value?f=h.select:void 0!==h.checked&&a.is(":checked")?f=h.checked:void 0===h.not_checked||a.is(":checked")||(f=h.not_checked):f=h.empty;void 0!==h.responsive&&a.is("select")&&(g=h.responsive,k&&void 0!==g.disabled&&void 0!==this.styleData.breakpoint_desktop[a.prop("id")]&&_.contains(g.disabled,this.styleData.breakpoint_desktop[a.prop("id")])&&(f=h[this.styleData.breakpoint_desktop[a.prop("id")]]));if(f){h=[];void 0!==f.show&&
(h=f.show);void 0!==f.hide&&(h=h.concat(f.hide));if(void 0===d||0===d.length)d=e("#themify_builder_lightbox_container",top_iframe);c=0;for(h=h.length;c<h;++c)void 0!==f.hide&&void 0!==f.hide[c]&&e("."+f.hide[c],d).addClass("_tf-hide").hide(),void 0!==f.show&&void 0!==f.show[c]&&e("."+f.show[c],d).removeClass("_tf-hide").show();if(void 0!==f.responsive)for(h=[],void 0!==f.responsive.disabled&&(h=h.concat(f.responsive.disabled)),c=0,h=h.length;c<h;++c)void 0!==f.responsive.disabled&&void 0!==f.responsive.disabled[c]&&
(k?e("."+f.responsive.disabled[c],d).addClass("reponive_disable"):e("."+f.responsive.disabled[c],d).removeClass("reponive_disable"))}if(g)for(d=[],void 0!==g.disabled&&(d=d.concat(g.disabled)),c=0,h=d.length;c<h;++c)void 0!==g.disabled&&void 0!==g.disabled[c]&&a.find('option[value="'+g.disabled[c]+'"]').prop("disabled",k)},moduleOptionsBinding:function(){var a=this;e("#themify_builder_lightbox_container",top_iframe).on("change","[data-binding]",function(){a.doTheBinding(e(this),e.trim(e(this).val()),
e(this).closest(".tb_repeatable_field_content"))}).on("click",".themify-layout-icon[data-binding] a",function(){a.doTheBinding(e(this).parent(),e(this).prop("id"),e(this).closest(".tb_repeatable_field_content"))})},mode_change:function(a){function c(a){null===h&&(h=ThemifyBuilderCommon.Lightbox.$lightbox.find("#themify_builder_options_styling")[0]);g.styleData["breakpoint_"+a]=b.Forms.serialize("themify_builder_options_styling",g.styleData,a,!1)}function d(b,d,f){c(d);g.editComponentCallback(h,a,
g.styleData,!0)}var f="module"===a&&void 0!==b.activeModel.get("is_new")?e(".tb_element_cid_"+b.activeModel.cid).closest(".module_row"):e(".tb_element_cid_"+b.activeModel.cid);b.beforeEvent=ThemifyBuilderCommon.Lightbox.clone(f);var g=this,h=null;g.styleData={};g.styleData.breakpoint_desktop=e.extend(!0,{},b.activeModel.get("module"===a?"mod_settings":"styling"));for(var k in themifyBuilder.breakpoints)void 0!==g.styleData.breakpoint_desktop["breakpoint_"+k]&&(g.styleData["breakpoint_"+k]=g.styleData.breakpoint_desktop["breakpoint_"+
k],delete g.styleData.breakpoint_desktop["breakpoint_"+k]);e("body").off("themify_builder_change_mode",d).on("themify_builder_change_mode",d).one("themify_builder_lightbox_before_close",function(){x=[];b.saving&&c(b.activeBreakPoint);e("body").off("themify_builder_change_mode",d)})},editComponentCallback:function(a,c,d,f){var g="styling",h=b.Mixins.Common,k=c,l=[],m=[],r=[],p=[],w=[],t=[],n=!1,z="desktop"!==b.activeBreakPoint?Object.keys(themifyBuilder.breakpoints).reverse():!1;"module"===c&&(k=b.activeModel.get("mod_name"),
g="mod_settings",n=void 0!==b.activeModel.get("is_new"));if(!1!==z){for(var u=z.indexOf(b.activeBreakPoint),q=0;q<=u;++q)z.shift();z.push("desktop")}var D=function(a,c,d,g){var q="";g?q=a.getAttribute("data-input-id"):(q=a.getAttribute("name"))||(q=a.getAttribute("id"));var v=c&&void 0!==c[q]?c[q]:!1;if(f||"px"!==v&&"pixels"!==v&&"solid"!==v&&"|"!==v&&"default"!==v){var y=e(a),u=a.classList;if(!n&&!1!==z&&!g&&!v)if(u.contains("themify-checkbox"))void 0!==d[q]&&0===y.closest("#themify_builder_options_styling").length&&
(v=d[q]);else{g=0;for(var E=z.length;g<E;++g)if(void 0!==d["breakpoint_"+z[g]]&&void 0!==d["breakpoint_"+z[g]][q]){v=d["breakpoint_"+z[g]][q];break}else if("desktop"===z[g]&&void 0!==d[q]){v=d[q];break}}if(u.contains("themify-gradient"))p.push({k:y,v:v}),v&&y.val(v);else if(u.contains("themify-builder-uploader-input"))v?(d=e("<img/>",{src:v,width:50,height:50}),y.val(v).parent().find(".img-placeholder").html(d)):f&&y.val("").parent().find(".img-placeholder").empty();else if(u.contains("themify-option-query-cat"))v&&
(d=y.parent(),g=v.split("|")[0],d.find("#"+q+"_dropdown").children("option[value='"+g+"']").prop("selected",!0),d.find(".query_category_multiple").val(g));else if(u.contains("tb-radio-input-container"))d=null,g=v?v:void 0!==y.data("default")?y.data("default"):!1,!1!==g&&""!==g?(d=y.find("input[value='"+g+"']"),d.is(":disabled")?d=null:d.prop("checked",!0)):f&&u.contains("tb-icon-radio")&&y.find("input").prop("checked",!1),null===d&&(d=y.find("input:checked")),0<d.length&&u.contains("tb-option-radio-enable")&&
m.push(d);else if(u.contains("themify-checkbox")){d=y.find(".tb-checkbox");!v&&_.isEmpty(c)&&(v=d.map(function(){return e(this).is(":checked")?e(this).val():null}).get().join("|"));if(v){var F=v.split("|");d.each(function(){-1!==F.indexOf(e(this).val())&&e(this).prop("checked",!0)})}else if(!n||f)if(g=d.closest(".themify_builder_input").find(".tb_seperate_items input"),g.length){var x=!1;g.each(function(){if(e(this).val().length)return x=!0,!1});d.prop("checked",!x)}else d.prop("checked",!1);u.contains("tb-option-checkbox-enable")&&
r.push(d)}else if(u.contains("themify-layout-icon"))v?y.find("a").filter(function(){e(this).removeClass("selected");if(v===e(this).prop("id"))return e(this)}).addClass("selected"):(d=themifyBuilder.modules[k],void 0!==d&&void 0!==d.defaults&&d.defaults[q]?y.find("#"+d.defaults[q]).addClass("selected"):y.find("a").first().addClass("selected"));else if("SELECT"===a.tagName)v?(y.val(v),u.contains("font-family-select")&&y.data("selected",v)):f&&y.find("option").prop("selected",!1),f&&u.contains("font-family-select")&&
(-1===y.prop("tabindex")?y.trigger("change.select"):v&&(d=y.find("optgroup"),void 0!==ThemifyBuilderCommon.safe_fonts[v]?d.first().html('<option selected="selected" data-type="webfont" value="'+v+'">'+ThemifyBuilderCommon.safe_fonts[v]+"</option>"):d.last().html('<option selected="selected" value="'+v+'">'+ThemifyBuilderCommon.google_fonts[v]+"</option>")));else if("TEXTAREA"===a.tagName||"INPUT"===a.tagName){d="TEXTAREA"===a.tagName;if(v||f)f&&!v&&(v=""),y.val(v),u.contains("minicolors-input")?(g=
v,q="",-1!==v.indexOf("_")?(g=b.Utils.toRGBA(v),v=v.split("_"),(q=v[1])||(q=1),y.val(v[0])):v&&(-1===v.indexOf("#")&&(g="#"+v),q=1),y.attr("data-opacity",q).next(".minicolors-swatch").find("span").css({background:g,opacity:q}).closest(".minicolors").next(".color_opacity").val(q)):d&&!n&&(u.contains("tb-shortcode-input")||u.contains("tb-thumbs-preview"))&&h.getShortcodePreview(y,v);d&&u.contains("tb_lb_wp_editor")&&l.push(y)}else if(u.contains("themify_builder_row_js_wrapper")){var E=v?v.length-1:
0,B=e.Event("click",{isTrigger:!0,currentTarget:y.next(".add_new").find("a").first()});void 0===b.cache.repeaterElements[q]&&(c=a.getElementsByClassName("tb_repeatable_field"),b.cache.repeaterElements[q]=e(c[0]).clone());for(g=0;g<E;++g)b.Forms.moduleOptAddRow(B,null);c=a.getElementsByClassName("tb_repeatable_field");g=0;for(q=c.length;g<q;++g){a=c[g].getElementsByClassName("tb_lb_option_child");for(var E=void 0!==v[g]?v[g]:!1,B=0,A=a.length;B<A;++B)D(a[B],E,d,!0)}w.push({el:y,binding_type:y.data("control-binding")})}y.data("binding")&&
t.push({el:y,v:v});f||!y.data("control-binding")||u.contains("tb_lb_wp_editor")||u.contains("minicolors-input")||u.contains("themify-gradient")||"repeater"===y.data("control-type")||b.Views.init_control(y.data("control-type"),{el:y,binding_type:y.data("control-binding"),selector:y.data("live-selector")})}};d=f?d:b.activeModel.get(g);var B=e.extend(!0,{},d);if("desktop"!==b.activeBreakPoint||f)if(void 0!==B["breakpoint_"+b.activeBreakPoint])B=B["breakpoint_"+b.activeBreakPoint];else for(q=0,g=z.length;q<
g;++q)if(void 0!==B["breakpoint_"+z[q]]){B=B["breakpoint_"+z[q]];break}g=a.getElementsByClassName("tb_lb_option");q=0;for(u=g.length;q<u;++q)D(g[q],B,d,!1),f||g[q].addEventListener("change",function F(a){a.currentTarget.removeEventListener(a.type,F);b.hasChanged=!0},{once:!0},!1);g=null;f||(0<w.length&&setTimeout(function(){for(var a=0,c=w.length;a<c;++a)b.Views.init_control("repeater",w[a]);w=null},1),setTimeout(function(){if("module"===c)for(var a=0,b=t.length;a<b;++a)h.doTheBinding(t[a].el,t[a].v);
t=null;h.moduleOptionsBinding()},1));setTimeout(function(){for(var a=0,c=m.length;a<c;++a)ThemifyBuilderCommon.Lightbox.clickRadioOption(null,m[a]);m=null},1);setTimeout(function(){for(var a=0,c=r.length;a<c;++a)ThemifyBuilderCommon.Lightbox.clickCheckboxOption(null,r[a]);r=null},1);setTimeout(function(){h.applyAll_init(f);for(var c=a.getElementsByClassName("border_style"),b=0,d=c.length;b<d;++b)ThemifyBuilderCommon.Lightbox.hideShowBorder(null,e(c[b]))},1);void 0!==e.fn.ThemifyGradient&&setTimeout(function(){for(var a=
0,c=p.length;a<c;++a)b.Utils.createGradientPicker(p[a].k,p[a].v,f);p=null},1);f||(setTimeout(function(){ThemifyBuilderCommon.fontPreview(e("#themify_builder_lightbox_container",top_iframe))},300),n&&"gallery"===k&&setTimeout(function(){e(".tb-gallery-btn",a).trigger("click")},1),setTimeout(function(){b.Utils.builderPlupload("normal")},1),setTimeout(function(){b.Utils.setColorPicker(a)},1),"visual"===b.mode&&(setTimeout(function(){x="module"===c?b.Forms.serialize("themify_builder_options_setting"):
B;b.liveStylingInstance.init(x)},1),n||ThemifyBuilderCommon.Lightbox.rememberRow()),setTimeout(function(){if(0<l.length){var a=function(){for(var a=0,c=l.length;a<c;++a)b.Views.init_control("wp_editor",{el:l[a],binding_type:l[a].data("control-binding"),selector:l[a].data("live-selector")});l=null};if(b.activeModel.get("styleClicked")||b.activeModel.get("visibileClicked"))e("body").one("themify_builder_tabsactive",function(c,b,d){"#themify_builder_options_setting"===b&&a()});else a()}h.mode_change(c)},
1),e("body").trigger("editing_"+c+"_option",[k,B,a]),"visual"===b.mode&&window.top.jQuery("body").trigger("editing_"+c+"_option",[k,B,a]))},applyAll_init:function(a){var c=e(".style_apply_all",top_iframe);c.off("change.tb_apply_all").on("change.tb_apply_all",function(a){var c=e(this).closest(".themify_builder_input").find(".tb_seperate_items"),b=c.find("li");a=!a.isTrigger;e(this).is(":checked")?(a?b.not(":first-child").slideUp():b.not(":first-child").hide(),c.attr("data-checked",1)):(b.slideDown(),
c.removeAttr("data-checked"));a&&b.first().find("select").trigger("change")});a||(c=c.filter(":checked"));c.trigger("change.tb_apply_all")},getShortcodePreview:function(a,c){function b(c){a.next(".tb_shortcode_preview").remove();c&&a.after(c)}var f=this;void 0===f.galerry_cache&&(f.galerry_cache={});void 0!==f.galerry_cache[c]?b(f.galerry_cache[c]):e.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tb_load_shortcode_preview",tb_load_nonce:themifyBuilder.tb_load_nonce,shortcode:c},success:function(a){b(a);
f.galerry_cache[c]=a}})}};b.Mixins.Builder={rowSort:function(){var a=!1,c=this,d,f,g,h={items:".module_row",handle:".themify_builder_row_top",axis:"y",placeholder:"themify_builder_ui_state_highlight",containment:"parent",tolerance:"pointer",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!1,beforeStart:function(d,g){c.dragScroll();"visual"!==b.mode||g.item.hasClass("collapsed")||(a=!0,g.item.addClass("collapsed ui-sortable-row"))},start:function(a,c){d=c.placeholder.index();g=c.item.outerHeight(!0);
c.item.nextAll(".module_row").css("transform","translateY("+g+"px)")},change:function(a,c){f=c.placeholder.index();var b=!1;d>f?(b=e(".module_row"),b=b.slice(f,b.length)):d<f&&(b=e(".module_row").slice(d,f),g=0);!1!==b&&b.not(".ui-sortable-helper").each(function(){e(this).css("transform","translateY("+g+"px)")});d=f},stop:function(b,d){a&&(d.item.removeClass("collapsed ui-sortable-row"),a=!1);e(".ui-sortable-handle, .module_row").css("transform","");c.dragScroll(!0)},update:function(a,b){b.item.hasClass("predesigned_row")&&
e(document).trigger("tb_setpredesignedrows",[b.item.data("slug"),function(a){c.rowDrop(a,b.item)}]);b.item.hasClass("tb_row_grid")&&e(document).trigger("tb_setpremaderows",[b.item.data("slug"),function(a){c.rowDrop(a,b.item)}])}};"visual"===b.mode&&(h.helper=function(){return e('<div class="themify_builder_sortable_helper"/>')});this.$el.sortable(h);this.columnSort(this.$el)},columnSort:function(a){var c,d=e("body"),f;a.find(".row_inner, .subrow_inner").sortable({items:"> .module_column",handle:"> .themify_builder_column_action .themify_builder_column_dragger",
axis:"x",placeholder:"themify_builder_ui_state_highlight",tolerance:"pointer",cursorAt:{top:20,left:20},beforeStart:function(a,b){d.addClass("themify_builder_drag_start");c=ThemifyBuilderCommon.Lightbox.clone(b.item.closest(".module_row"));f=b.item.siblings();f.css("marginLeft",0)},start:function(a,c){e(".themify_builder_ui_state_highlight").width(c.item.width())},stop:function(a,c){d.removeClass("themify_builder_drag_start");f.css("marginLeft","")},update:function(a,d){var f=d.item.closest(".ui-sortable"),
g=f.children(".module_column");g.removeClass("first last");f.hasClass("direction-rtl")?(g.last().addClass("first"),g.first().addClass("last")):(g.first().addClass("first"),g.last().addClass("last"));b.Utils.columnDrag(f,!1);b.Utils.setCompactMode(g);f=f.closest(".module_row");b.vent.trigger("dom:change",f.data("cid"),c,f,"row")}})},update:function(a){var c=null!==b.activeModel?b.activeModel.get("elType"):b.Models.Registry.lookup(a.data("cid")).get("elType");"visual"===b.mode&&b.Utils.loadContentJs(a,
c);b.Mixins.Builder.initGridMenu(a[0],"module"!==c);b.Mixins.Builder.columnSort(a);a=a.closest(".module_row");b.Utils.columnDrag(a.find(".row_inner"),!1);b.Utils.columnDrag(a.find(".subrow_inner"),!1);this.updateModuleSort(a)},dragScroll:function(a){var c=e("body",top_iframe);"visual"===b.mode&&(c=c.add(e("body")));void 0===this.top&&(this.top=b.toolbar.$el,this.top=this.top.add(e("#themify_builder_fixed_bottom_scroll",top_iframe)),"visual"!==b.mode&&(this.top=this.top.add("#wpadminbar")));if(!0===
a)this.top.off("mouseenter"),c.removeClass("themify_builder_drag_start");else{var d="desktop"===b.activeBreakPoint?e("body,html"):e("body,html",top_iframe),f="",g=0;"visual"===b.mode?(f=d.height(),g=e(window.parent).height()):f=e("#page-builder").height();c.addClass("themify_builder_drag_start");this.top.off("mouseenter").on("mouseenter",function(a){a=parseInt((f-g)/7);if(0<a){var c=e(this).prop("id");a=("tb_toolbar"===c||"wpadminbar"===c?"-":"+")+("="+a+"px");d.stop().animate({scrollTop:a},800)}else d.stop()})}},
updateModuleSort:function(a,c){var d=c?e(".themify_module_holder"):a.find(".themify_module_holder");if(c)return d.sortable(c),!1;d.each(function(){e(this).data().uiSortable=null});var f=!1,g=!1,h=this,k={placeholder:"themify_builder_ui_state_highlight",items:".active_module",connectWith:".themify_module_holder",revert:100,scroll:!1,tolerance:"pointer",cursorAt:{top:20,left:110},beforeStart:function(a,c){!1===g&&(g=ThemifyBuilderCommon.Lightbox.clone(c.item.closest(".module_row")),"visual"===b.mode&&
(c.item.css("height",40),f=!0),h.dragScroll())},stop:function(a,c){h.dragScroll(!0);if("dragstop"!==a.type){f&&(c.item.css("height",""),f=!1);var d=c.item.closest(".module_row");b.vent.trigger("dom:change",c.item.data("cid"),g,d,"sort",{before:g.data("cid"),after:d.data("cid")})}g=!1},update:function(a,c){c.sender?(c.item.hasClass("module_subrow")&&0<c.item.parents(".module_subrow").length?(c.item.find(".active_module").clone().insertAfter(c.item),c.item.remove()):b.Mixins.Builder.initGridMenu(c.item[0]),
b.vent.trigger("dom:builder:change")):c.item.hasClass("tb_module_dragging_helper")&&(x=[],h.moduleDrop(c.item,!1))}};"visual"===b.mode&&(k.helper=function(){return e('<div class="themify_builder_sortable_helper"/>')},k.handle=".themify_builder_module_front_overlay, .themify_builder_subrow_top");d.sortable(k)},initModuleDraggable:function(a){var c=this;a.find(".themify_builder_module").draggable({appendTo:"body",helper:"clone",revert:"invalid",scroll:!1,connectToSortable:".themify_module_holder",containment:"#themify_builder_row_wrapper,.themify_builder_content",
cursorAt:{top:10,left:40},start:function(a,f){c.dragScroll();f.helper.addClass("tb_module_dragging_helper").removeClass("themify_builder_module");b.toolbar.preDesignedRows.btn.hide()},stop:function(a,b){c.dragScroll(!0)}})},initModuleVisualDrag:function(){var a=this;b.toolbar.$el.find(".themify_builder_module").ThemifyDraggable({iframe:"#themify_builder_site_canvas_iframe",dropitems:".themify_module_holder",elements:".active_module",onDragStart:function(a,d){b.toolbar.preDesignedRows.btn.hide()},
onDragEnd:function(a,b){},onDrop:function(c,b,f){a.moduleDrop(b,!1)}})},initRowDraggable:function(a){var c=this;a.find(".predesigned_row").draggable({appendTo:"body",helper:"clone",revert:"invalid",connectToSortable:"#themify_builder_row_wrapper,.themify_builder_content",cursorAt:{top:10,left:40},start:function(a,f){c.dragScroll();f.helper.addClass("tb_module_dragging_helper").find(".tb_predesigned_rows_list_image").remove();b.toolbar.preDesignedRows.btn.hide()},stop:function(a,b){c.dragScroll(!0)}})},
initGridsDraggable:function(a){var c=this;a.find(".tb_premade_rows_grid .tb_row_grid").draggable({appendTo:"body",helper:"clone",revert:"invalid",connectToSortable:"#themify_builder_row_wrapper,.themify_builder_content,.themify_module_holder",cursorAt:{top:10,left:40},start:function(a,f){c.dragScroll();f.helper.addClass("tb_module_dragging_helper");b.toolbar.preDesignedRows.btn.hide()},stop:function(a,b){c.dragScroll(!0)}})},initRowGridVisualDrag:function(){var a=this;b.toolbar.$el.find(".tb_row_grid").ThemifyDraggable({iframe:"#themify_builder_site_canvas_iframe",
dropitems:".themify_module_holder, .module_row",append:!1,onDragStart:function(a,d){b.toolbar.preDesignedRows.btn.hide()},onDrop:function(c,b,f){e(document).trigger("tb_setpremaderows",[b.data("slug"),function(c){f.hasClass("themify_module_holder")?a.subRowDrop(c,b):a.rowDrop(c,b)}])}})},initRowVisualDrag:function(){var a=this;b.toolbar.$el.find(".predesigned_row").ThemifyDraggable({iframe:"#themify_builder_site_canvas_iframe",dropitems:".module_row",append:!1,onDragStart:function(a,d){b.toolbar.preDesignedRows.btn.hide()},
onDragEnd:function(a,b){},onDrop:function(c,b,f){e(document).trigger("tb_setpredesignedrows",[b.data("slug"),function(c){a.rowDrop(c,b)}])}})},subRowDrop:function(a,c){if(c.closest(".sub_column").length)c.closest(".module_subrow").find('.themify_builder_grid_list [data-col="'+c.data("slug")+'"]').first().trigger("click");else{var d=b.Views.init_subrow(a,b.mode);c.parent().hasClass("themify_module_holder")?c[0].parentNode.replaceChild(d.view.render().el,c[0]):c.prev().hasClass("themify_module_holder")?
c.parent().find("> .themify_module_holder").append(d.view.render().$el):c.parent().find("> .themify_module_holder").prepend(d.view.render().$el);for(var f=a[0].cols.length,g,e=0;e<f;++e)g="",0===e&&(g="first "),e===f-1&&(g="last "),b.Utils._addNewColumn({newclass:g+a[0].cols[e].grid_class,component:"sub-column",type:b.mode},d.view.$el.find(".subrow_inner"))}c.remove()},rowDrop:function(a,c){function d(){var a=c.prev(".module_row"),d=c.closest(".themify_builder_content").data("postid"),a=0===a.length?
!1:a.data("cid");c[0].innerHTML="";c[0].parentNode.replaceChild(f,c[0]);b.saveCid=!1;b.rowStyling=[];b.vent.trigger("dom:change","","","","predesign",{prev:a,rows:g,bid:d});a=0;for(d=g.length;a<d;++a)b.Mixins.Builder.update(g[a]);ThemifyBuilderCommon.showLoader("hide")}var f=document.createDocumentFragment(),g=[];b.saveCid=!0;for(var e in a)if(a[e].cols&&(0<Object.keys(a[e].cols).length||a[e].cols[0].styling&&0<Object.keys(a[e].cols[0].styling).length)||a[e].styling&&0<Object.keys(a[e].styling).length){var k=
b.Views.init_row(a[e],b.mode);!1!==k&&(k=k.view.render(),f.appendChild(k.el),g.push(k.$el))}"visual"===b.mode?b.bootstrap(b.rowStyling,d):d()},moduleDrop:function(a,c){var d=this;if(a.hasClass("tb_row_grid"))e(document).trigger("tb_setpremaderows",[a.data("slug"),function(c){d.subRowDrop(c,a)}]);else{var f=b.Views.init_module({mod_name:a.data("module-slug")},b.mode),g=f.view.render();f.model.set({is_new:1},{silent:!0});c?c.append(g.el):a.replaceWith(g.el);f.view.trigger("edit",null);b.hasChanged=
!0;"visual"===b.mode&&(g=f.model.getPreviewSettings(),1<Object.keys(g).length&&("ajax"===a.data("type")?f.model.trigger("custom:preview:refresh",g):f.model.trigger("custom:preview:live",g)))}},newRowAvailable:function(){var a=this.$el.children(".module_row");if(0===a.length||0<a.last().find(".active_module").length)a=b.Views.init_row({cols:[{grid_class:"col-full"}]},this.type).view.render().$el,a.appendTo(this.$el),this.$el.sortable(this.$el.sortable("option")),b.Mixins.Builder.updateModuleSort(a),
"visual"===b.mode&&"desktop"!==b.activeBreakPoint&&e("body",top_iframe).height(document.body.scrollHeight)},initGridMenu:function(a,c){var b=!0===c?a.getElementsByClassName("active_module"):[a];void 0===this.grid_menu&&(this.grid_menu=ThemifyBuilderCommon.templateCache.get("tmpl-builder_grid_menu"),this.grid_menu=e(this.grid_menu),this.grid_menu.find(".grid-layout--full").closest("li").addClass("selected"),this.grid_menu=this.grid_menu[0].outerHTML);for(var f=0,g=b.length;f<g;++f)-1===b[f].className.indexOf("module_subrow")&&
0===b[f].getElementsByClassName("grid_menu").length&&0===e(b[f]).closest(".sub_column").length&&b[f].insertAdjacentHTML("afterbegin",this.grid_menu)},toJSON:function(){for(var a={},c=this.el.getElementsByClassName("module_row"),d=0,f=c.length;d<f;++d)a[d]=b.Utils._getRowSettings(c[d],d);return a}};b.Forms={Data:{},Validators:{},bindEvents:function(){e("body",top_iframe).on("true"===themifyBuilder.isTouch?"touchend":"click",".builder_save_button",this.saveComponent).on("click","#themify_builder_lightbox_parent .add_new a",
this.moduleOptAddRow).on("click","#builder_submit_import_form",this.builderImportSubmit).on("click",".tb-lightbox-switcher a",this.lightbox_switcher).on("click",".layout_preview img",this.templateSelected).on("click","#builder_submit_layout_form",this.saveAsLayout);e("body").on("themify_builder_lightbox_close",this.clear);this.widget_actions()},getFormTemplates:function(){function a(a){var c="";if("string"===typeof a)c=a;else for(var b in a)c+=a[b];document.getElementsByTagName("body")[0].insertAdjacentHTML("beforeend",
c)}var c=function(){if(themifyBuilder.debug)return!1;try{var a=localStorage.getItem("tb_form_templates"),c="";if(!a)return!1;var a=JSON.parse(a),b;for(b in themifyBuilder.modules)c+=b;return a.ver.toString()!==tbLocalScript.version.toString()||a.h!==Themify.hash(c)?!1:a.val}catch(h){}return!1}();c?a(c):e.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:{action:"tb_load_form_templates",tb_load_nonce:themifyBuilder.tb_load_nonce},success:function(c){if(c){a(c);c=c.replace(/\s\s+/g," ");try{var b="",
d;for(d in themifyBuilder.modules)b+=d;var e={val:c,ver:tbLocalScript.version,h:Themify.hash(b)};localStorage.setItem("tb_form_templates",JSON.stringify(e))}catch(k){}}}})},parseSettings:function(a,c,b,f){var d=!1,h=e(a),k=a.classList,l="",m=!0;f?l=h.data("input-id"):(l=a.getAttribute("name"))||(l=a.getAttribute("id"));if(k.contains("tb_lb_wp_editor"))void 0!==tinyMCE?(d=a.getAttribute("id"),a=tinyMCE.get(d),d=null!==a?!1===a.hidden?a.getContent():switchEditors.wpautop(tinymce.DOM.get(d).value):h.val()):
d=h.val();else if(k.contains("themify-checkbox")){var r=[];h.find(".tb-checkbox:checked").each(function(a){r.push(e(this).val())});d=0<r.length?r.join("|"):!1;r=null;m=!1}else if(k.contains("themify-layout-icon"))d=h.find(".selected").prop("id");else if(k.contains("themify-option-query-cat"))a=h.parent(),d=a.find(".query_category_single"),a=a.find(".query_category_multiple"),d=a.val()?a.val()+"|multiple":d.val()+"|single";else if(k.contains("themify_builder_row_js_wrapper"))for(d=[],a=a.getElementsByClassName("tb_repeatable_field_content"),
f=0,k=a.length;f<k;++f){var p=a[f].getElementsByClassName("tb_lb_option_child");d[f]={};for(var w=0,t=p.length;w<t;++w){var n=this.parseSettings(p[w],c,b,!0);n&&"px"!==n.v&&"pixels"!==n.v&&"solid"!==n.v&&"default"!==n.v&&"|"!==n.v&&(d[f][n.id]=n.v)}}else k.contains("tb-radio-input-container")?(m=h.find("input:checked"),"desktop"!==b&&m.hasClass("reponive_disable")||(d=m.val()),m=!1):k.contains("module-widget-form-container")?d=h.find(":input").themifySerializeObject():(d=h.val(),a=h.attr("data-opacity"),
void 0!==a&&""!==a&&1!=a&&"0.99"!==a&&(d+="_"+a));if(d||!c)if(!c||c&&"px"!==d&&"pixels"!==d&&"solid"!==d&&"linear"!==d&&"default"!==d&&"|"!==d&&("desktop"===b||0===h.closest(".reponive_disable").length))return c||!1!==d||(d=""),{id:l,v:d,checked:m};return!1},serialize:function(a,c,d){d=d||b.activeBreakPoint;var f=void 0!==c;void 0===this.breakpoints&&"desktop"!==d&&f&&(this.breakpoints=Object.keys(themifyBuilder.breakpoints).reverse());var g={};a=top_iframe.getElementById(a).getElementsByClassName("tb_lb_option");
var e="desktop"!==d&&f&&void 0!==this.breakpoints?this.breakpoints:!1;if(!1!==e){for(var k=e.indexOf(d),l=0;l<=k;++l)e.shift();e.push("desktop")}l=0;for(k=a.length;l<k;++l){var m=this.parseSettings(a[l],f,d,!1);if(!1!==m){if(!1!==e&&!0===m.checked&&"SELECT"!==a[l].tagName){for(var r=!1,p=0,w=e.length;p<w;++p)if(void 0!==c["breakpoint_"+e[p]]&&void 0!==c["breakpoint_"+e[p]][m.id]&&c["breakpoint_"+e[p]][m.id]===m.v){r=!0;break}else if("desktop"===e[p]&&void 0!==c[m.id]&&c[m.id]===m.v){r=!0;break}if(r)continue}g[m.id]=
m.v}}return g},saveComponent:function(a){var c=null===a;c||a.preventDefault();if(b.hasChanged){var d=b.Forms,f=b.activeModel.get("elType");a="module"===f;if(!a||d.isValidate(e("#tb_module_settings",top_iframe))){e("body").trigger("themify_builder_save_component");"visual"===b.mode&&window.top.jQuery("body").trigger("themify_builder_save_component");b.saving=!0;var g={},h=null,k=!1,l=!1,m=null,r=null,p=!1,w="styling",t=e(".tb_element_cid_"+b.activeModel.cid);if(a||"row"===f)a&&(w="mod_settings",k=
b.activeModel.get("is_new"),b.activeModel.unset("is_new",{silent:!0})),r=d.serialize("themify_builder_options_setting"),h=d.serialize("themify_builder_options_animation"),m=d.serialize("themify_builder_options_visibility"),"visual"===b.mode&&("hide_all"===m.visibility_all||"hide"===m.visibility_desktop||"hide"===m.visibility_tablet||"hide"===m.visibility_mobile?t.addClass("tb_visibility_hidden"):t.removeClass("tb_visibility_hidden"));"visual"===b.mode&&b.liveStylingInstance.remember(b.activeModel.cid);
c?e("body").trigger("themify_builder_lightbox_before_close"):ThemifyBuilderCommon.Lightbox.close(c);var d=e.extend(!0,{},b.Mixins.Common.styleData),f=e.extend(!0,{},b.activeModel.get(w)),n=d.breakpoint_desktop;delete d.breakpoint_desktop;for(var z in d)n[z]=d[z];g[w]=e.extend(!0,n,r,h,m);g[w]=b.Utils.clear(g[w]);b.activeModel.set(g,{silent:!0});a&&(k&&(l=ThemifyBuilderCommon.Lightbox.clone(t.closest(".module_column")),b.Mixins.Builder.initGridMenu(t[0])),b.vent.trigger("dom:builder:change"),e(".tb-import-layout-button").remove());
if("visual"===b.mode){var u=b.liveStylingInstance.getRememberedStyles();void 0===b.isComponentSaved[b.activeModel.cid]&&(b.isComponentSaved[b.activeModel.cid]=1,p=!0)}b.vent.trigger("dom:change",b.activeModel.cid,b.beforeEvent,t,"save",{old:f,"new":g[w],styles:u,column:l,first:p});b.beforeEvent=!1;b.saving=!1;c&&ThemifyBuilderCommon.Lightbox.close(c)}}else ThemifyBuilderCommon.Lightbox.close(c)},moduleOptAddRow:function(a,c){a.preventDefault();var d=e(a.currentTarget).parent().prev(),f=b.cache.repeaterElements[d.prop("id")].clone(),
g=Math.random().toString(36).substr(2,7),h=[],k=!1,l=!1,m=!a.isTrigger||c;f.removeClass("collapsed").find(".row_inner").show();var r=f[0].getElementsByClassName("tb_lb_option_child");c=c?e(c):!1;for(var p=0,w=r.length;p<w;++p){var t=e(r[p]);var n=c?c.find('[data-input-id="'+t.data("input-id")+'"]'):!1;var z=r[p].classList;if(z.contains("tb_lb_wp_editor")){var u=t.data("input-id");var q=t.data("control-repeater");var D=t.closest(".wp-editor-wrap");t=u+"_"+p+"_"+Math.random().toString(36).substr(2,
7);!1===k&&(k=D[0].innerHTML);D[0].innerHTML=k.replace(new RegExp(u,"g"),t);t=D.find(".tb_lb_wp_editor");t.attr({name:u,"data-input-id":u,"data-control-repeater":q}).data({"input-id":u,"control-repeater":q});n?(n=n.prop("id"),D=tinyMCE.get(n),n=!1===D.hidden?D.getContent():switchEditors.wpautop(tinymce.DOM.get(n).value),t.val(n)):t.val("");h.push(t)}else if(z.contains("themify-layout-icon"))D=t.find("a"),D.removeClass("selected"),n?D.filter("#"+n.find(".selected").prop("id")).addClass("selected"):
(n=themifyBuilder.modules[b.activeModel.get("mod_name")],void 0!==n&&void 0!==n.defaults&&n.defaults[u]?D.filter("#"+n.defaults[u]).addClass("selected"):D.first().addClass("selected"));else if(z.contains("themify-builder-uploader-input"))m&&(l=!0,n=!1!==n?n.val():"",D=t.val(n).parent(),q=D.find(".thumb_preview").find(".img-placeholder"),D.find(".tb-upload-btn").prop("id","pluploader_"+g+"_"+p+"themify-builder-plupload-upload-ui").addClass("plupload-clone").find(".builder_button").prop("id","pluploader_"+
g+"_"+p+"themify-builder-plupload-browse-button"),""!==n&&(n=e("<img/>",{src:n,width:50,height:50}),q.html(n)));else if(z.contains("tb-radio-input-container")){D=r[p].getElementsByClassName("themify-builder-radio-dnd");q=t.data("input-id");var B=n?n.find(":checked").val():!1;n=0;for(var x=D.length;n<x;++n){var A=e(D[n]);A.prop({name:q+"_"+g,id:q+"_"+g+"_"+n,checked:!1}).next("label").prop("for",q+"_"+g+"_"+n);(B===A.val()||!B&&A.data("checked"))&&A.prop("checked",!0)}z.contains("tb-option-radio-enable")&&
ThemifyBuilderCommon.Lightbox.clickRadioOption(null,t.find(":checked"))}else B=n?n.val():"",void 0===B&&(B=""),t.val(B);m&&(t.data("binding")&&b.Mixins.Common.doTheBinding(t,B,f),!t.data("control-binding")||z.contains("tb_lb_wp_editor")||z.contains("minicolors-input")||z.contains("themify-gradient")||b.Views.init_control(t.data("control-type"),{el:t,binding_type:t.data("control-binding"),selector:t.data("live-selector")}))}m&&setTimeout(function(){b.Utils.setColorPicker(f)},1);d[0].appendChild(f[0]);
m&&(0<h.length&&setTimeout(function(){for(var a=0,c=h.length;a<c;++a)b.Views.init_control("wp_editor",{el:h[a],binding_type:h[a].data("control-binding"),selector:h[a].data("live-selector")});h=null},1),l&&b.Utils.builderPlupload("new_elemn"))},builderImportSubmit:function(a){a.preventDefault();var c=e(this);ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.dialog_import_page_post,function(a){e.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"builder_import_submit",
nonce:themifyBuilder.tb_load_nonce,data:c.closest("form").serialize(),importType:"no"===a?"replace":"append",importTo:themifyBuilder.post_ID},beforeSend:function(a){ThemifyBuilderCommon.showLoader("show")},success:function(a){b.Forms.reLoad(a,themifyBuilder.post_ID);ThemifyBuilderCommon.Lightbox.close()}})},{buttons:{no:{label:"Replace Existing Builder"},yes:{label:"Append Existing Builder"}}})},lightbox_switcher:function(a){a.preventDefault();a=e(a.currentTarget).attr("href").replace("#","");b.activeModel&&
"visual"===b.mode&&(b.scrollTo=b.liveStylingInstance.$liveStyledElmt);e(".tb_breakpoint_switcher.breakpoint-"+a,top_iframe).trigger("click")},reLoad:function(a,c){function d(){"visual"===b.mode&&(b.Utils.loadContentJs(),b.id=!1);b.vent.trigger("dom:builder:init");ThemifyBuilderCommon.showLoader("hide");"visual"===b.mode&&"desktop"!==b.activeBreakPoint&&(e("body",top_iframe).height(document.body.scrollHeight),setTimeout(function(){e("body",top_iframe).height(document.body.scrollHeight)},2E3))}b.Models.Registry.destroy();
b.Instances.Builder={};var f="";if("visual"===b.mode){var g="themify-builder-"+c+"-generated-css",h=e("link#"+g),f="#themify_builder_content-"+c;b.id=c;h.remove();void 0!==a.css&&void 0!==a.css.css_file&&(g="<link id="+g+' type="text/css" rel="stylesheet" href="'+a.css.css_file+"?tmp="+Date.now()+'" />',document.getElementById("themify-builder-admin-ui-css").insertAdjacentHTML("afterend",g));b.VisualCache=[];b.editing=!1;b.isComponentSaved=[];setTimeout(function(){b.liveStylingInstance.reset()},1);
e("body").addClass("sidebar-none full_width")}else f="#themify_builder_row_wrapper";b.Instances.Builder[0]=new b.Views.Builder({el:f,collection:new b.Collections.Rows(a.builder_data),type:"visual"});b.Instances.Builder[0].render();b.toolbar.undoManager.reset();"visual"===b.mode?b.bootstrap(null,d):d()},templateSelected:function(a){a.preventDefault();a.stopPropagation();var c=e(this).closest(".layout_preview");ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.confirm_template_selected,
function(a){var d=themifyBuilder.post_ID,g={type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_set_layout",mode:"no"===a?1:0,nonce:themifyBuilder.tb_load_nonce,layout_slug:c.data("slug"),id:d,layout_group:c.data("group")},beforeSend:function(){"visual"===b.mode&&ThemifyBuilderCommon.showLoader("show")},success:function(a){ThemifyBuilderCommon.Lightbox.close();"success"===a.status?b.Forms.reLoad(a,d):(ThemifyBuilderCommon.showLoader("error"),alert(a.msg))}};if("pre-designed"===
c.data("group")){ThemifyBuilderCommon.showLoader("show");var h=c.data("slug"),k="https://themify.me/themify-layouts/"+h+".txt",l=function(){g.data.builder_data=b.layouts_selected[h];e.ajax(g)};if(!b.layouts_selected)b.layouts_selected={};else if(b.layouts_selected[h]){l();return}e.get(k,null,null,"text").done(function(a){b.layouts_selected[h]=a;l()}).fail(function(a,c,b){ThemifyBuilderCommon.LiteLightbox.alert("There was an error in loading layout, please try again later, or you can download this file: ("+
k+") and then import manually (http://themify.me/docs/builder#import-export).")}).always(function(){ThemifyBuilderCommon.showLoader()})}else e.ajax(g)},{buttons:{no:{label:"Replace Existing Layout"},yes:{label:"Append Existing Layout"}}})},saveAsLayout:function(a){a.preventDefault();e.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_save_custom_layout",nonce:themifyBuilder.tb_load_nonce,form_data:e("#tb_save_layout_form",top_iframe).serialize()},success:function(a){"success"===
a.status?ThemifyBuilderCommon.Lightbox.close():alert(a.msg)}})},widget_actions:function(){var a={},c=!1,d=!1,f=!1;e("body",top_iframe).on("change","#class_widget",function(){var g=e(this).val(),h=e(this).find(" :selected").data("idbase"),k=c["widget-id"],l=function(h,k){var l=e("#instance_widget",top_iframe),m=e(k.form),t=function(a){"text"===a?d||(d=!0,wp.textWidgets.init()):f||(wp.mediaWidgets.init(),f=!0);e(document).trigger("widget-added",[l]);"text"===a&&b.Views.init_control("wp_editor",{el:l.find(".wp-editor-area"),
binding_type:"refresh"})},n=function(a,c,b){var d=a.length;(function(a,c,b){Themify.LoadAsync(a,c,null,null,b)})(a[c],function(){++c;c<d?n(a,c,b):t(b)})};if(c)for(var r in c)m.find('[name="'+r+'"]').val(c[r]);m.find(".widget-id").val(Math.random());m.find("select").wrap('<span class="selectwrapper"/>');l.html(m.html());void 0===a[h]&&k.template?(document.getElementsByTagName("body")[0].insertAdjacentHTML("beforeend",k.template),0<k.src.length&&n(k.src,0,h)):k.init&&t(h,k.form);"visual"===b.mode&&
g&&l.find(":input").first().trigger("change")};x.class_widget=g;void 0!==a[h]&&k===a[h].widgetID?l(h,a[h]):e.ajax({type:"POST",dataType:"json",url:themifyBuilder.ajaxurl,data:{action:"module_widget_get_form",tb_load_nonce:themifyBuilder.tb_load_nonce,load_class:g,tpl_loaded:+(0<e("#tmpl-media-modal").length),id_base:h,widget_instance:c},success:function(c){c&&c.form&&(l(h,c),a[h]={form:c.form,init:0<c.src.length,widgetID:k})}})});e("body").on("editing_module_option",function(a,b,d,f){"widget"===b&&
d.instance_widget&&(c=d.instance_widget,setTimeout(function(){e("#class_widget",f).trigger("change");c=!1},200))})},isValidate:function(a){var c=a.find("[data-validation]");if(0===c.length)return!0;var b=this,f={};c.each(function(){var a=e(this),c=a.data("validation"),d=a.val();b.checkValidate(c,d)||(f[a.prop("id")]=a.data("error-msg"))});a.find(".tb_field_error").removeClass("tb_field_error").end().find(".tb_field_error_msg").remove();if(_.isEmpty(f))return!0;var g=0;_.each(f,function(c,b){var d=
a.find("#"+b);d.addClass("tb_field_error");e("<span/>",{"class":"tb_field_error_msg","data-error-key":b}).text(c).insertAfter(d);g||(d=a.children().index(d.closest(".themify_builder_options_tab_wrapper")),(d=-1<d&&a.closest("#themify_builder_lightbox_parent").find(".themify_builder_options_tab > li").eq(d))&&!d.hasClass("current")&&d.trigger("click"),g++)});return!1},checkValidate:function(a,c){return b.Forms.get_validator(a)(c)},clear:function(){if(b.activeModel&&(void 0!==b.activeModel.get("is_new")&&
b.activeModel.trigger("dom:module:unsaved"),b.activeModel=null,void 0!==tinyMCE))for(var a=tinymce.editors.length-1;-1<a;a--)"content"!==tinymce.editors[a].id&&tinyMCE.execCommand("mceRemoveEditor",!0,tinymce.editors[a].id)}};b.Forms.register_validator=function(a,c){this.Validators[a]=c};b.Forms.get_validator=function(a){return void 0!==this.Validators[a]?this.Validators[a]:this.Validators.not_empty};b.Forms.register_validator("email",function(a){var c=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
a=a.split(",");return!(0<e.map(a,function(a,b){return c.test(a)?null:"1"}).length)});b.Forms.register_validator("not_empty",function(a){return!(!a||""===a.trim())});b.Views.Toolbar=Backbone.View.extend({events:{"click .tb_import":"import","click .themify_builder_load_layout":"loadLayout","click .themify_builder_save_layout":"saveLayout","click .themify_builder_dup_link":"duplicate","click .tb_toolbar_save":"save","click .tb_toolbar_backend_edit a":"save","click .tb_toolbar_close_btn":"panelClose",
"click .tb_breakpoint_switcher":"breakpointSwitcher","click .themify_builder_zoom":"zoom","click .tb_toolbar_zoom_menu_toggle":"zoom","click .tb_toolbar_builder_preview":"previewBuilder"},initialize:function(){var a=[],c=this,d=this.$el.find(".tb_module_panel_modules_wrap"),f=wp.template("builder_module_item_draggable"),g;for(g in themifyBuilder.modules)a.push(f({slug:g,name:themifyBuilder.modules[g].name,type:themifyBuilder.modules[g].type?themifyBuilder.modules[g].type:"",favorite:+themifyBuilder.modules[g].favorite}));
d[0].innerHTML=a.join("")+'<span class="favorite-separator"></span>';e("#tmpl-builder_module_item_draggable").remove();"visual"===b.mode&&e("body",top_iframe)[0].appendChild(this.el);a=null;setTimeout(function(){c.Panel.init();c.undoManager.init();"visual"===b.mode?(window.top.jQuery("body").one("themify_builder_ready",function(a){new SimpleBar(d[0])}),c.unload()):new SimpleBar(d[0]);c.preDesignedRows.init()},1);setTimeout(function(){c.Revisions.init()},800);e("body",top_iframe).on("click",".themify_module_favorite",
c.toggleFavoriteModule);if("visual"===b.mode)e("body").on("click",".themify_module_favorite",c.toggleFavoriteModule);c.compactToolbar()},compactToolbar:function(){function a(){setTimeout(function(){b.toggleClass("compact-toolbar",g>c.$el.outerWidth()-80)},50)}var c=this,b=e("body",top_iframe),f={display:c.$el.css("display"),opacity:c.$el.css("opacity")};c.$el.css({display:"block",opacity:0});var g=c.$el.find(".tb_toolbar_menu").outerWidth()+c.$el.find(".tb_toolbar_save_wrap").outerWidth();c.$el.css(f);
window.top.jQuery("body").on("themify_builder_ready",a);e(window.top).on("resize",a);c.$el.find(".tb_toolbar_divider").each(function(){var a=e(this).nextUntil(".tb_toolbar_divider");if(1<a.length&&!a.eq(0).hasClass("tb_toolbar_compact_item")){var c=a.clone();a.eq(0).addClass("tb_toolbar_compact_item").append('<ul class="tb_compact_group"></ul>').find(".tb_compact_group").append(c)}})},"import":function(a){a.preventDefault();a=ThemifyBuilderCommon.detectBuilderComponent(e(a.currentTarget));var c=null,
d={dataType:"html",data:{action:"builder_import",type:a}};if("file"!==a||confirm(themifyBuilder.i18n.importFileConfirm))"file"===a&&(c=function(){b.Utils.builderPlupload("",!0)}),ThemifyBuilderCommon.Lightbox.open(d,null,c)},unload:function(){var a=this;"visual"===b.mode&&document.getElementsByTagName("head")[0].insertAdjacentHTML("afterbegin",'<base target="_parent">');window.top.onbeforeunload=function(){return!b.editing&&a.undoManager.hasUndo()?"Are you sure":null}},panelClose:function(a){a.preventDefault();
window.parent.location.reload(!0)},undoManager:{stack:[],is_working:!1,index:-1,btnUndo:document.getElementsByClassName("tb-undo-btn")[0],btnRedo:document.getElementsByClassName("tb-redo-btn")[0],init:function(){var a=this;b.toolbar.$el.find(".tb-undo-redo").on("click",this.do_change.bind(this));if(!themifyBuilder.disableShortcuts&&(e(top_iframe).on("keydown",this.keypres.bind(this)),"visual"===b.mode))e(document).on("keydown",this.keypres.bind(this));b.vent.on("dom:change",function(c,d,f,g,h){b.hasChanged&&
(b.editing=!1,f&&(f=ThemifyBuilderCommon.Lightbox.clone(f)),"visual"!==b.mode||"duplicate"!==g&&"sort"!==g||e(window).trigger("tfsmartresize.tfVideo"),a.stack.splice(a.index+1,a.stack.length-a.index),a.stack.push({cid:c,type:g,data:h,before:d,after:f}),a.index=a.stack.length-1,a.updateUndoBtns(),"visual"===b.mode&&e("body").trigger("builder_dom_changed",[g]))})},set:function(a){var c=a[0].querySelectorAll("[data-cid]"),c=Array.prototype.slice.call(c);c.unshift(a[0]);a=0;for(var d=c.length;a<d;++a){var f=
b.Models.Registry.lookup(c[a].getAttribute("data-cid"));f&&f.trigger("change:view",c[a])}},doScroll:function(a){("visual"!==b.mode||"desktop"===b.activeBreakPoint?e("body"):e("body",top_iframe)).scrollTop(a.offset().top)},keypres:function(a){if(90===a.which&&"INPUT"!==document.activeElement.tagName&&"TEXTAREA"!==document.activeElement.tagName)if(!0===a.ctrlKey&&!0===a.shiftKey||!0===a.metaKey&&!0===a.shiftKey)a.preventDefault(),this.hasRedo()&&this.changes(!1);else if(!0===a.ctrlKey||!0===a.metaKey)a.preventDefault(),
this.hasUndo()&&this.changes(!0)},changes:function(a){var c=this.stack[this.index+(a?0:1)];if(void 0!==c){this.is_working=!0;var d="";var f=c.type,g=e(".tb_element_cid_"+c.cid);var h=!1;if("row"===f)a?(d=c.before.clone(!0),h=c.cid):(d=c.after.clone(!0),h=c.before.data("cid"),g=e(".tb_element_cid_"+h)),this.set(d),g.replaceWith(d);else if("duplicate"===f)a?e(".tb_element_cid_"+c.after.data("cid")).remove():(d=c.after.clone(!0),h=c.before.data("cid"),this.set(d),g.after(d));else if("delete_row"===f)a?
(d=c.before.clone(!0),h=c.cid,g=e(".tb_element_cid_"+c.data.pos_cid),this.set(d),"after"===c.data.pos?g.after(d):g.before(d)):g.remove();else if("sort"===f)h=c.cid,a?(g=c.data.after,f=c.data.before,d=c.before.clone(!0)):(g=c.data.before,f=c.data.after,d=c.after.clone(!0),"visual"===b.mode&&d.find(".active_module").css({display:"block",height:"auto"})),this.set(d),e(".tb_element_cid_"+g).find(".tb_element_cid_"+h).remove(),e(".tb_element_cid_"+f).replaceWith(d);else if("save"===f){h=c.cid;var f=b.Models.Registry.lookup(h),
k="module"===f.get("elType"),l={},m=k?"mod_settings":"styling";k&&c.data.column?a?(h=!1,g.remove()):(h=c.data.column.data("cid"),d=c.data.column.clone(!0),g=e(".tb_element_cid_"+h),this.set(d),g.replaceWith(d)):(a?(l[m]=c.data.old,d=c.before.clone(!0)):(l[m]=c.data["new"],d=c.after.clone(!0)),f.set(l,{silent:!0}),this.set(d),g.replaceWith(d),"visual"===b.mode&&b.liveStylingInstance.doUndo(c.data.styles,a?c.data.first:!1))}else if("predesign"===f)if(g=c.data.rows,a)for(f=0,k=g.length;f<k;++f)e(".tb_element_cid_"+
g[f].data("cid")).remove();else{l=document.createDocumentFragment();d=[];f=0;for(k=g.length;f<k;++f)m=ThemifyBuilderCommon.Lightbox.clone(g[f]),l.appendChild(m[0]),d.push(m);!1!==c.data.prev?e(".tb_element_cid_"+c.data.prev).after(l):e("#themify_builder_content-"+c.data.bid).prepend(l);f=0;for(k=d.length;f<k;++f)this.set(d[f]),b.Mixins.Builder.update(d[f])}else if("import"===f){var g=e('[data-postid="'+c.data.bid+'"]'),c=a?c.data.before.clone(!0):c.data.after.clone(!0),r=this;g.children().remove();
g.prepend(c);c.each(function(){r.set(e(this))})}h&&b.Mixins.Builder.update(d);a?this.index--:this.index++;this.is_working=!1;this.updateUndoBtns()}},hasRedo:function(){return this.index<this.stack.length-1},hasUndo:function(){return-1!==this.index},disable:function(){this.btnUndo.classList.add("tb_disabled");this.btnRedo.classList.add("tb_disabled")},updateUndoBtns:function(){this.hasUndo()?this.btnUndo.classList.remove("tb_disabled"):this.btnUndo.classList.add("tb_disabled");this.hasRedo()?this.btnRedo.classList.remove("tb_disabled"):
this.btnRedo.classList.add("tb_disabled")},reset:function(){this.stack=[];this.index=-1;this.updateUndoBtns()},do_change:function(a){a.preventDefault();!1===this.is_working&&-1===a.currentTarget.className.indexOf("tb_disabled")&&this.changes(-1!==a.currentTarget.className.indexOf("tb-undo-btn"))}},loadLayout:function(a){function c(a){a.each(function(a){0===a%4?e(this).addClass("layout-column-break"):e(this).removeClass("layout-column-break")})}a.preventDefault();var b=this;ThemifyBuilderCommon.Lightbox.open(b.layouts_list?
{loadMethod:"html",data:b.layouts_list}:{data:{action:"tb_load_layout"}},null,function(a){function d(){var a=f.find(".layout_preview_list");k.show().find("a").on("click",function(b){b.preventDefault();e(this).hasClass("selected")||(b=a,e(this).hasClass("all")||(a.hide(),b=a.filter('[data-category*="'+e(this).text()+'"]')),b.show(),c(b),k.find("a").removeClass("selected"),e(this).addClass("selected"),k.parent().find(".tb_filter_layouts").html(e(this).text()))});f.find("#themify_builder_layout_search").on("keyup",
function(){var b=e.trim(e(this).val()),d=a;""!==b&&(d=k.find("a.all"),d.hasClass("selected")||d.click(),a.hide(),d=a.find(".layout_title:contains("+b+")").closest(".layout_preview_list"));d.show();c(d)})}a=e(a);var f=a.find("#themify_builder_tabs_pre-designed"),k=f.find("#themify_builder_pre-designed-filter");0!=f.length&&(b.layouts_list?d():(ThemifyBuilderCommon.showLoader("show"),e.getJSON("https://themify.me/themify-layouts/index.json").done(function(g){var h=window.top.wp.template("themify-builder-layout-item"),
l={},p="";g=e(h(g));g.find("li").each(function(){for(var a=e(this).data("category").split(","),c=0,b=a.length;c<b;++c)""!==a[c]&&void 0===l[a[c]]&&(p+='<li><a href="#">'+a[c]+"</a></li>",l[a[c]]=1)});l=null;k[0].insertAdjacentHTML("beforeend",p);f[0].insertAdjacentHTML("beforeend",g[0].outerHTML);a.find(".themify_builder_tab").each(function(){c(e(this).find(".layout_preview_list"))});b.layouts_list=a[0];d();new SimpleBar(a[0])}).fail(function(a,c,b){ThemifyBuilderCommon.LiteLightbox.alert(e("#themify_builder_load_layout_error",
f).show().text())}).always(function(){ThemifyBuilderCommon.showLoader("spinhide")})))})},saveLayout:function(a){a.preventDefault();ThemifyBuilderCommon.Lightbox.open({data:{action:"tb_custom_layout_form",postid:themifyBuilder.post_ID}},function(){b.Utils.builderPlupload("normal")})},duplicate:function(a){function c(){d.Revisions.ajax({action:"tb_duplicate_page",tb_is_admin:"visual"!==b.mode},function(a){a&&(window.top.location.href=e("<div/>").html(a).text())})}a.preventDefault();var d=this;confirm(themifyBuilder.i18n.confirm_on_duplicate_page)?
b.Utils.saveBuilder(c):c()},Revisions:{init:function(){b.toolbar.$el.find(".tb_revision").on("click",this.revision.bind(this));e("body",top_iframe).on("click",".js-builder-restore-revision-btn",this.restore.bind(this)).on("click",".js-builder-delete-revision-btn",this["delete"].bind(this))},revision:function(a){a.preventDefault();a.currentTarget.classList.contains("tb_save_revision")?this.save():this.load()},load:function(){ThemifyBuilderCommon.Lightbox.open({data:{action:"tb_load_revision_lists",
postid:themifyBuilder.post_ID,tb_load_nonce:themifyBuilder.tb_load_nonce}})},ajax:function(a,c){a=e.extend({},a,{tb_load_nonce:themifyBuilder.tb_load_nonce,postid:themifyBuilder.post_ID});return e.ajax({type:"POST",url:themifyBuilder.ajaxurl,data:a,beforeSend:function(){ThemifyBuilderCommon.showLoader("show")},complete:function(){ThemifyBuilderCommon.showLoader("hide")},success:function(a){e.isFunction(c)&&c.call(this,a)}})},save:function(a){var c=this;ThemifyBuilderCommon.LiteLightbox.prompt(themifyBuilder.i18n.enterRevComment,
function(d){null!==d&&b.Utils.saveBuilder(function(){c.ajax({action:"tb_save_revision",rev_comment:d},a)},"main",0,!0)})},restore:function(a){a.preventDefault();var c=e(a.currentTarget).data("rev-id"),d=this,f=function(){d.ajax({action:"tb_restore_revision_page",revid:c},function(a){a.status?(b.Forms.reLoad(a,themifyBuilder.post_ID),ThemifyBuilderCommon.Lightbox.close()):(ThemifyBuilderCommon.showLoader("error"),alert(a.data))})};ThemifyBuilderCommon.LiteLightbox.confirm(themifyBuilder.i18n.confirmRestoreRev,
function(a){"yes"===a?d.save(f):f()},{buttons:{no:{label:"Don't Save"},yes:{label:"Save"}}})},"delete":function(a){a.preventDefault();if(confirm(themifyBuilder.i18n.confirmDeleteRev)){var c=e(a.currentTarget);a=c.data("rev-id");this.ajax({action:"tb_delete_revision",revid:a},function(a){a.success?c.closest("li").remove():(ThemifyBuilderCommon.showLoader("error"),alert(a.data))})}}},save:function(a){a.preventDefault();a.stopPropagation();var c=0<e(a.currentTarget).closest(".tb_toolbar_backend_edit").length?
e(a.currentTarget).prop("href"):!1;b.Utils.saveBuilder(function(a,f){"success"!==f?alert(themifyBuilder.i18n.errorSaveBuilder):!1!==c&&("visual"===b.mode?(sessionStorage.setItem("focusBackendEditor",!0),window.top.location.href=c):(b.toolbar.undoManager.reset(),b._backendSwitchFrontend()))})},preDesignedRows:{is_init:null,rows:[],btn:null,filter_toolbar:null,filter_btn:null,clicked:null,init:function(){this.btn=e('<div class="tb_modules_panel_wrap" id="tb_plus_btn_popover"></div>');e("body").append(this.btn);
setTimeout(function(){document.getElementsByTagName("head")[0].insertAdjacentHTML("afterbegin",'<meta http-equiv="x-dns-prefetch-control" content="on"/><link href="//themify.me" rel="dns-prefetch preconnect"/><link href="//fonts.googleapis.com" rel="dns-prefetch"/><link href="//maps.google.com" rel="dns-prefetch"/><link href="https://themify.me/public-api/predesigned-rows/index.json" rel="prefetch"/>')},7E3);var a=this;this.btn.on("click",".add_module_btn",function(c){b.toolbar.Panel.add_module(c,
a.clicked.closest(".module_row").find(".themify_module_holder").last());a.clicked=null;a.btn.hide()}).on("keyup",".tb_module_panel_search_text",this.search.bind(this));if("visual"===b.mode)b.toolbar.$el.find(".tb_module_types a").on("click",this.tabs.bind(this));b.toolbar.$el.find(".tb_module_panel_search_text").on("keyup",this.search.bind(this));e("body").on("click",".tb_module_types a",this.tabs.bind(this)).on("click",".tb_row_btn_plus",this.show.bind(this));e(document).on("tb_setpredesignedrows",
this.get.bind(this));e(document).on("tb_setpremaderows",this.grid.bind(this))},load:function(a,c){if(null===this.is_init){this.is_init=!0;var d=this;a.addClass("tb_busy");e.getJSON("https://themify.me/public-api/predesigned-rows/index.json").done(function(b){d.setData(b,a,c)}).fail(function(a,c,d){this.is_init=null;ThemifyBuilderCommon.showLoader("error");b.toolbar.$el.find(".tb_predesigned_rows_list").html("<h3>Failed to load Pre-Designed Rows from server.</h3>")})}},setData:function(a,c,d){for(var f=
[],e="",h="",k=0,l=a.length;k<l;++k){for(var m=a[k].category.split(","),r="",p=0,w=m.length;p<w;++p)-1===f.indexOf(m[p])&&f.push(m[p]),r+=" tb"+Themify.hash(m[p]);if(void 0===a[k].thumbnail||""===a[k].thumbnail)a[k].thumbnail="https://placeholdit.imgix.net/~text?txtsize=24&txt="+encodeURI(a[k].title)+"&w=181&h=77";h+='<div class="predesigned_row'+r+'" data-slug="'+a[k].slug+'"><figure class="tb_predesigned_rows_list_image">';h+='<img alt="'+a[k].title+'" title="'+a[k].title+'" src="'+a[k].thumbnail+
'" /></figure>';h+='<div class="tb_predesigned_rows_list_title">'+a[k].title+"</div></div>"}a=null;f.sort();k=0;for(l=f.length;k<l;++k)e+='<li><a href="#" data-slug="'+Themify.hash(f[k])+'">'+f[k]+"</li>";b.toolbar.$el.find(".tb_row_filter")[0].insertAdjacentHTML("beforeend",e);var t=b.toolbar.$el.find(".tb_predesigned_rows_list");t[0].insertAdjacentHTML("beforeend",h);this.btn[0].insertAdjacentHTML("beforeend",b.toolbar.$el.find("#tb_module_panel")[0].innerHTML);this.btn.find(".tb_module_panel_lock").remove();
this.btn.find(".themify_builder_module_outer").show();this.btn.find(".tb_module_panel_search_text").val("");var n=this;t.find("img").last().one("load",function(){n.filter();"visual"===b.mode?(b.Mixins.Builder.initRowVisualDrag(),b.Mixins.Builder.initRowGridVisualDrag()):(b.Mixins.Builder.initRowDraggable(b.toolbar.$el),b.Mixins.Builder.initGridsDraggable(b.toolbar.$el));c.removeClass("tb_busy");new SimpleBar(t[0]);new SimpleBar(n.btn.find(".tb_module_panel_modules_wrap")[0]);new SimpleBar(n.btn.find(".tb_predesigned_rows_list")[0]);
b.Mixins.Builder.initModuleDraggable(n.btn);b.Mixins.Builder.initRowDraggable(n.btn);b.Mixins.Builder.initGridsDraggable(n.btn);"function"===typeof d&&d()})},grid:function(a,c,b){a=[];if(1==c)a.push({grid_class:"col-full"});else for(var d=0;d<c;d++)a.push({grid_class:"col"+c+"-1"});b([{cols:a}])},get:function(a,c,b){ThemifyBuilderCommon.showLoader("show");if(void 0!==this.rows[c])"function"===typeof b&&b(this.rows[c]);else{var d=this;e.getJSON("https://themify.me/public-api/predesigned-rows/"+c+".txt").done(function(a){d.rows[c]=
a;"function"===typeof b&&b(a)}).fail(function(a,c,b){ThemifyBuilderCommon.showLoader("error");alert("Failed to fetch row template")})}},tabs:function(a){a.preventDefault();a.stopPropagation();a=e(a.currentTarget);var c=a.data("target"),b=a.closest(".tb_modules_panel_wrap");null===this.is_init&&this.load(b);b.find("."+c).show().siblings(".tb_module_panel_tab").hide();a.closest("li").addClass("active").siblings().removeClass("active");b.find(".tb_module_panel_search_text").val("")},show:function(a){function c(){"visual"===
b.mode&&"desktop"!==b.activeBreakPoint&&(e("body",top_iframe).height(document.body.scrollHeight+d.btn.outerHeight(!0)),e("body").css("padding-bottom",180))}a.preventDefault();a.stopPropagation();var d=this;this.clicked=e(a.currentTarget);a=this.clicked.offset();this.btn.css({top:a.top,left:a.left-this.btn.width()/2+12}).show();null===this.is_init?this.load(this.btn,c):c();this.hide()},hide:function(){function a(d){c.btn.is(":hover")||(c.btn.hide(),c.clicked=null,e(document).off("click",a),e(top_iframe).off("click",
a),"visual"===b.mode&&"desktop"!==b.activeBreakPoint&&(e("body",top_iframe).height(document.body.scrollHeight),e("body").css("padding-bottom","")))}var c=this;if("visual"===b.mode)e(top_iframe).on("click",a);e(document).on("click",a)},search:function(a){a=e(a.currentTarget);var c=a.closest(".tb_modules_panel_wrap"),b="tb_module_panel_modules_wrap"===c.find(".tb_module_types .active a").data("target"),f=!b&&this.is_init?"tb_module_panel"===c.prop("id")?this.filter_toolbar:this.filter_btn:!1,c=b?c.find(".themify_builder_module_outer"):
this.is_init?c.find(".predesigned_row"):!1;a=e.trim(a.val());if(!1!==c){var g=""===a,h=g?!1:new RegExp(a,"i");c.each(function(){if(f&&!e(this).hasClass(f))return!0;var a=b?e(this).find(".module_name"):e(this).find(".tb_predesigned_rows_list_title");g||h.test(a.text())?e(this).show():e(this).hide()})}},filter:function(){function a(a){a.preventDefault();a.stopPropagation();a=e(a.currentTarget);var c=a.data("slug"),b=a.closest(".tb_modules_panel_wrap"),g=b.find(".tb_row_filter_active"),h=b.find(".predesigned_row");
g.text(a.text());b.find(".tb_module_panel_search_text").val("");if(c){var k="tb"+c;h.each(function(){e(this).hasClass(k)?e(this).show():e(this).hide()})}else h.show();"tb_module_panel"===b.prop("id")?this.filter_toolbar=k:this.filter_btn=k}b.toolbar.$el.find(".tb_row_filter").on("click","a",a.bind(this));this.btn.find(".tb_row_filter").on("click","a",a.bind(this))}},breakpointSwitcher:function(a){function c(){f.responsive_grids(g,l);"visual"===b.mode&&m.css("will-change","auto");k.toggleClass("tb_responsive_mode",
"desktop"!==g).removeClass("builder-breakpoint-"+l).addClass("builder-breakpoint-"+g);e("body").trigger("themify_builder_change_mode",[l,g]);"visual"===b.mode?(b.Mixins.Builder.updateModuleSort(null,"desktop"===g?"enable":"disable"),b.Utils._onResize(!0,function(){f.iframeScroll("desktop"!==g);e("body",top_iframe).height("desktop"!==g?document.body.scrollHeight:"auto");b.scrollTo&&setTimeout(function(){e(window).add(top_iframe).scrollTop(b.scrollTo.offset().top);b.scrollTo=!1},500);setTimeout(function(){b.Utils.setCompactMode(document.getElementsByClassName("module_column"));
k.removeClass("tb_start_animate")},200)})):k.removeClass("tb_start_animate")}a.preventDefault();if(themifyBuilder.is_premium){var d="",f=this,g="desktop",h=e(a.currentTarget),k=e("body",top_iframe),l=b.activeBreakPoint;h.hasClass("breakpoint-tablet")?g="tablet":h.hasClass("breakpoint-tablet_landscape")?g="tablet_landscape":h.hasClass("breakpoint-mobile")&&(g="mobile");if(l===g&&void 0!==a.originalEvent)return!1;b.activeBreakPoint=g;"visual"===b.mode&&(k=k.add("body"));k.addClass("tb_start_animate");
"desktop"!==g&&(d=b.Utils.getBPWidth(g)-1);if("visual"===b.mode){var m=e("#themify_builder_site_canvas_iframe",top_iframe);e(".tb_toolbar_zoom_menu",top_iframe).removeClass("tb_toolbar_zoom_active").find(".tb_toolbar_zoom_menu_toggle").data("zoom",100);(d="tablet_landscape"===g&&ThemifyBuilderCommon.Lightbox.dockMode.get()&&e(".themify_builder_workspace_container",top_iframe).width()<d?e(".themify_builder_workspace_container",top_iframe).width():d)&&m.width()!=d?m.css("will-change","width").one(b.Utils.transitionPrefix(),
c).css("width",d).parent().removeClass("themify_builder_zoom_bg"):(m.css("width",d).parent().removeClass("themify_builder_zoom_bg"),c())}else c()}},iframeScroll:function(a){var c=e(top_iframe);c.off("scroll.themifybuilderresponsive");if(a)c.on("scroll.themifybuilderresponsive",function(){window.scrollTo(0,e(this).scrollTop())})},responsive_grids:function(a,c){for(var b=document.querySelectorAll(".row_inner,.subrow_inner"),f="desktop"===a,g=f||"desktop"===c,h=0,k=b.length;h<k;++h){var l=b[h].getAttribute("data-basecol");
if(l){var m=b[h].children,r=b[h].dataset["col_"+a],p=m[0],w=m[m.length-1];if(!f){if("desktop"!==c){b[h].classList.remove("tb_3col");var t=b[h].getAttribute("data-col_"+c);t&&b[h].classList.remove(e.trim(t.replace("tb_3col","").replace("mobile","column").replace("tablet","column")))}if(r&&"-auto"!==r){if(r=b[h].getAttribute("data-col_"+a)){b[h].classList.add("tb_grid_classes");b[h].classList.add("col-count-"+l);var r=r.split(" "),n;for(n in r)b[h].classList.add(e.trim(r[n].replace("mobile","column").replace("tablet",
"column")))}}else b[h].classList.remove("tb_grid_classes"),b[h].classList.remove("col-count-"+l)}if(g)for(l=0,r=m.length;l<r;++l)t=e(m[l]).data("w"),void 0!==t&&(m[l].style.width=f?t+"%":"");"rtl"===b[h].getAttribute("data-"+a+"_dir")?(p.classList.remove("first"),p.classList.add("last"),w.classList.remove("last"),w.classList.add("first"),b[h].classList.add("direction-rtl")):(p.classList.remove("last"),p.classList.add("first"),w.classList.remove("first"),w.classList.add("last"),b[h].classList.remove("direction-rtl"))}}},
Panel:{el:null,is_locked:!1,key:"tb_module_panel_locked",init:function(){this.el=b.toolbar.$el.find(".tb_toolbar_add_modules_wrap");this.el.blur().hover(this.toogle.bind(this)).find(".tb_module_panel_lock").on("click",this.lock.bind(this));this._setupModulePanelState();this.el.find(".add_module_btn").on("click",this.add_module)},add_module:function(a,c){a.preventDefault();a.stopPropagation();c=c||b.Instances.Builder[0].$el.find(".module_row").last().find(".themify_module_holder").first();var d=c.offset().top-
37;"visual"===b.mode?"desktop"!==b.activeBreakPoint&&e(top_iframe).scrollTop(d):d-=50;e(window).scrollTop(d);b.Mixins.Builder.moduleDrop(e(a.currentTarget).closest(".themify_builder_module"),c)},resetPanel:function(){this.el.removeClass("tb_disabled");this.is_locked&&this.toggleLock()},toogle:function(a){this.is_locked||this.el.hasClass("tb_disabled")||e(a.currentTarget).focus()},lock:function(a){a.preventDefault();this.is_locked=!this.is_locked;localStorage.setItem(this.key,this.is_locked);this.toggleLock();
if(!this.is_locked){this.el.addClass("tb_hide_panel");var c=this;setTimeout(function(){b.toolbar.$el.find("#themify_builder_switch_backend").focus();c.el.removeClass("tb_hide_panel")},1E3)}},toggleLock:function(){var a=b.toolbar.$el;"visual"===b.mode&&(a=a.add(e("body")),a.addClass("tb_remove_transitions"));e("body",top_iframe).toggleClass("tb_module_panel_locked");e(window).trigger("tfsmartresize");a.removeClass("tb_remove_transitions")},_setupModulePanelState:function(){this.is_locked=localStorage.getItem(this.key);
"false"===this.is_locked&&(this.is_locked=!1);if(this.is_locked){var a=this;setTimeout(function(){a.toggleLock()},1200)}},hide:function(){this.el.blur();if(this.is_locked){this.el.removeClass("tb_disabled");var a=b.toolbar.$el;"visual"===b.mode&&(a=a.add(e("body")),a.addClass("tb_remove_transitions"));e("body",top_iframe).removeClass("tb_module_panel_locked");e(window).trigger("tfsmartresize");a.removeClass("tb_remove_transitions")}this.el.addClass("tb_disabled")},show:function(){this.is_locked||
this.el.focus()}},toggleFavoriteModule:function(){var a=e(this),c=a.closest(".themify_builder_module_outer"),d=a.parent().data("module-slug");e.ajax({type:"POST",url:themifyBuilder.ajaxurl,dataType:"json",data:{action:"tb_module_favorite",module_name:d,module_state:+!c.hasClass("favorited")},beforeSend:function(a){function f(a,c){function g(){a.removeAttr("style");if(c){var g=0<a.closest("#tb_plus_btn_popover").length?b.toolbar.$el:e("#tb_plus_btn_popover");f(g.find(".module-type-"+d).closest(".themify_builder_module_outer"),
!1)}}if(a.is(":visible"))a.css({opacity:0,transform:"scale(0.5)"}).one(h,function(){a.toggleClass("favorited").css({opacity:1,transform:"scale(1)"}).one(h,g)});else a.toggleClass("favorited"),g()}var h=b.Utils.transitionPrefix();f(c,!0)}})},zoom:function(a){a.preventDefault();if("desktop"!==b.activeBreakPoint)return!0;var c=e(a.currentTarget);a=c.data("zoom");var d=e(".themify_builder_site_canvas_iframe",top_iframe),f=c.closest(".tb_toolbar_zoom_menu");c.hasClass("tb_toolbar_zoom_menu_toggle")?(a=
"100"==a?50:100,c.data("zoom",a),c=c.next("ul").find('[data-zoom="'+a+'"]')):f.find(".tb_toolbar_zoom_menu_toggle").data("zoom",a);d.removeClass("themify_builder_zooming_50 themify_builder_zooming_75");c.parent().addClass("selected-zoom-size").siblings().removeClass("selected-zoom-size");"50"==a||"75"==a?(c="50"==a?2:1.25,d.addClass("themify_builder_zooming_"+a).parent().addClass("themify_builder_zoom_bg").css("height",Math.max(window.top.innerHeight*c,600)),f.addClass("tb_toolbar_zoom_active"),b.zoomMeta.isActive=
!0,b.zoomMeta.size=a,e("body").addClass("tb-zoom-only")):(d.addClass("themify_builder_zooming_"+a).parent().css("height",""),f.removeClass("tb_toolbar_zoom_active"),b.zoomMeta.isActive=!1,e("body").removeClass("tb-zoom-only"))},previewBuilder:function(a){a.preventDefault();e(a.currentTarget).toggleClass("tb_toolbar_preview_active");b.isPreview=!b.isPreview;e("body").toggleClass("tb-preview-only themify_builder_active");e("body",top_iframe).toggleClass("tb-preview-parent");b.isPreview?this.Panel.hide():
this.Panel.resetPanel();(function(){b.isPreview?e(".col-count-1.row_inner").each(function(){if(0===this.getElementsByClassName("active_module").length){var a=this.getElementsByClassName("module_column")[0];if((a=b.Models.Registry.lookup(a.dataset.cid))&&0===Object.keys(a.get("styling")).length){var a=e(this).closest(".module_row"),d=b.Models.Registry.lookup(a.data("cid"));d&&0===Object.keys(d.get("styling")).length&&a.addClass("tb-hide")}}}):e(".tb-hide.module_row").removeClass("tb-hide")})();e(".builder-breakpoint-"+
b.activeBreakPoint+" a.breakpoint-"+b.activeBreakPoint,top_iframe).trigger("click");b.vent.trigger("dom:preview")}});b.Views.bindEvents=function(){ThemifyBuilderCommon.Lightbox.setup();ThemifyBuilderCommon.LiteLightbox.modal.on("attach",function(){this.$el.addClass("themify_builder_lite_lightbox_modal")});b.Utils.mediaUploader();b.Utils.openGallery()};b.Utils={onResizeEvents:[],gridClass:"col-full col4-1 col4-2 col4-3 col3-1 col3-2 col6-1 col5-1".split(" "),_onResize:function(a,c){var d=e._data(window,
"events").resize;if(""===tbLocalScript.fullwidth_support)e(window.top).off("tfsmartresize.tb_visual").on("tfsmartresize.tb_visual",function(a){e(window).trigger("tfsmartresize.tbfullwidth").trigger("tfsmartresize.tfVideo")});e(window.top).off("tfsmartresize.zoom").on("tfsmartresize.zoom",function(){if(b.zoomMeta.isActive){var a="50"==b.zoomMeta.size?2:1.25;e(".themify_builder_workspace_container",top_iframe).css("height",Math.max(window.top.innerHeight*a,600))}});if(void 0!==d)for(var f=0,g=d.length;f<
g;++f)void 0!==d[f].handler&&this.onResizeEvents.push(d[f].handler);e(window).off("resize");if(a){d=e.Event("resize",{type:"resize",isTrigger:!1});f=0;for(g=this.onResizeEvents.length;f<g;++f)try{this.onResizeEvents[f].apply(window,[d,e])}catch(h){}"function"===typeof c&&c()}},_addNewColumn:function(a,c){var d=b.Views.init_column({grid_class:a.newclass,component_name:a.component},a.type);c.append(d.view.render().$el)},filterClass:function(a){a=a.split(" ");for(var c=[],b=0,f=a.length;b<f;++b)-1!==
this.gridClass.indexOf(a[b])&&c.push(a[b]);return c.join(" ")},_getRowSettings:function(a,c,d){var f={};d=d||"row";var g={};var h=b.Models.Registry.lookup(a.dataset.cid);if(h){a=a.getElementsByClassName(d+"_inner")[0];g=a.children;d=0;for(var k=g.length;d<k;++d){var l=b.Models.Registry.lookup(g[d].dataset.cid);if(l){var m=g[d].getElementsByClassName("themify_module_holder");var r={};if(0<m.length){m=m[0].children;for(var p=0,w=m.length;p<w;++p){var t=b.Models.Registry.lookup(m[p].dataset.cid);if(t){var n=
b.Utils.clear(t.get("mod_settings"),!0);r[p]={mod_name:t.get("mod_name")};0<Object.keys(n).length&&(r[p].mod_settings=n);-1!==m[p].className.indexOf("module_subrow")&&(r[p]=this._getRowSettings(m[p],p,"subrow"))}}}f[d]={column_order:d,grid_class:this.filterClass(g[d].className)};0<Object.keys(r).length&&(f[d].modules=r);n=parseFloat(g[d].style.width);0<n&&!isNaN(n)&&(f[d].grid_width=n);n=b.Utils.clear(l.get("styling"),!0);0<Object.keys(n).length&&(f[d].styling=n)}}g={row_order:c,cols:f,column_alignment:h.get("column_alignment"),
gutter:h.get("gutter")};f={gutter:"gutter-default",column_alignment:A?"col_align_middle":"col_align_top"};c={desktop_dir:"ltr",tablet_dir:"ltr",tablet_landscape_dir:"ltr",mobile_dir:"ltr",col_tablet_landscape:"-auto",col_tablet:"-auto",col_mobile:"-auto"};for(d in g)""!==g[d]&&g[d]!==f[d]||delete g[d];n=b.Utils.clear(h.get("styling"),!0);for(d in c)h=e.trim(a.getAttribute("data-"+d)),void 0!==h&&""!==h&&h!==c[d]&&(g[d]=h);0<Object.keys(n).length&&(g.styling=n)}return g},selectedGridMenu:function(a){for(var c,
d,f,g,h=a.getElementsByClassName("grid_menu"),k=["mobile","tablet","tablet_landscape","desktop"],l=0,m=h.length;l<m;++l)if(a=e(h[l]),c=a.data("handle"),"module"!==c){d=a.closest(".module_"+c);f=b.Models.Registry.lookup(d.data("cid"));var r=[];c=d.find("."+c+"_inner").first();var p=f.get("gutter"),w=f.get("column_alignment");g=f.get("desktop_dir");for(var t=f.get("styling"),n="",z={},u=c[0].children,q=0,x=u.length;q<x;++q)r.push(b.Utils._getColClass(u[q].className.split(" "))),u[q].className=u[q].className.replace(/first|last/ig,
""),1!==x&&(0===q?u[q].className+="rtl"===g?" last":" first":q===x-1&&(u[q].className+="rtl"===g?" first":" last"));r=a.find(".themify_builder_grid_desktop .grid-layout-"+r.join("-"));q=r.data("col");0<r.length&&(r.parent().addClass("selected").siblings().removeClass("selected"),d.addClass("col-count-"+q),n="col-count-"+q,z["data-basecol"]=q);"ltr"!==g&&(n+=" direction-rtl");for(q=0;4>q;++q)g=f.get(k[q]+"_dir"),"ltr"!==g&&""!==g&&(z["data-"+k[q]+"_dir"]=g,r=a.find(".themify_builder_grid_"+k[q]+" .column-dir-"+
g),r.parent().addClass("selected").siblings().removeClass("selected")),"desktop"!==k[q]&&(g=f.get("col_"+k[q]),"-auto"!==g&&""!==g&&void 0!==g&&(z["data-col_"+k[q]]=g,r=a.find(".themify_builder_grid_"+k[q]+" .grid-layout-"+g.replace(/column|tb_3col/ig,"")),r.parent().addClass("selected").siblings().removeClass("selected")));t&&void 0!==t.row_anchor&&""!==t.row_anchor&&d.find(".row-anchor-name").first().text(t.row_anchor);"col_align_top"!==w&&(a.find(".column-alignment-"+w).parent().addClass("selected").siblings().removeClass("selected"),
n+=" "+w);"gutter-default"!==p&&(a.find(".gutter_select").val(p),n+=" "+p);c.addClass(n).attr(z)}},clear:function(a,c,b){b=b?[]:{};for(var d in a)if(Array.isArray(a[d])){var g=this.clear(a[d],c,!0);0<g.length&&(b[d]=g)}else if("object"===typeof a[d])g=this.clear(a[d],c,!1),e.isEmptyObject(g)||(b[d]=g);else if(a[d]&&"px"!==a[d]&&"pixels"!==a[d]&&"solid"!==a[d]&&"linear"!==a[d]&&"default"!==a[d]&&"|"!==a[d]&&!(-1!==d.indexOf("_gradient-css")||"cover_gradient_hover-css"===d||"background_image-css"===
d||"background_image-type_gradient"===d||-1!==d.indexOf("gradient-angle")&&"180"==a[d]||-1!==d.indexOf("_padding_apply_all_padding")||-1!==d.indexOf("_margin_apply_all_margin")||-1!==d.indexOf("_border_apply_all_border")||"text_align_right"===d||"text_align_center"===d||"text_align_left"===d||"text_align_justify"===d||"show"===a[d]&&-1!==d.indexOf("visibility_"))){if(c&&("cover_gradient_hover-gradient"===d||"background_image-gradient"===d||-1===d.indexOf("gradient-angle")&&-1!==d.indexOf("_gradient-gradient"))&&
(g=-1!==d.indexOf("background_gradient")?d.replace("_gradient","_type").replace("-gradient",""):d.replace("-gradient","-type").replace("_gradient","_color"),"gradient"!==a[g]&&"cover_gradient"!==a[g]&&"hover_gradient"!==a[g])){g=["gradient-angle","type_image","circle-radial","gradient-type"];for(var h=d.replace("-gradient",""),k=0,l=g.length;k<l;++k){var m=h+"-"+g[k];void 0!==a[m]&&(a[m]=b[m]=null,delete a[m],delete b[m])}continue}b[d]=a[d]}return b},builderPlupload:function(a,c){var d=e(".themify-builder-plupload-upload-uic"+
(c?"":"new_elemn"===a?".plupload-clone":""),top_iframe);if(0<d.length){var f=this;void 0===f.pconfig&&(f.pconfig=JSON.parse(JSON.stringify(themify_builder_plupload_init)),f.pconfig.multipart_params._ajax_nonce=themifyBuilder.tb_load_nonce,f.pconfig.multipart_params.topost=themifyBuilder.post_ID);d.each(function(){var a=e(this),d=a.prop("id").replace("themify-builder-plupload-upload-ui",""),k=e.extend(!0,{},f.pconfig),l=["browse_button","container","drop_element","file_data_name"];k.multipart_params.imgid=
d;for(var m=0,r=l.length;m<r;++m)k[l[m]]=d+f.pconfig[l[m]];a.data("extensions")?k.filters[0].extensions=a.data("extensions"):k.filters[0].extensions=null!==b.activeModel?k.filters[0].extensions.replace(/\,zip|\,txt/,""):"zip,txt";d=new window.top.plupload.Uploader(k);d.init();d.bind("FilesAdded",function(a,c){a.refresh();a.start();ThemifyBuilderCommon.showLoader("show")});d.bind("Error",function(a,c){var b=e(".prompt-box .show-error");e(".prompt-box .show-login").hide();b.show();0<b.length&&b.html('<p class="prompt-error">'+
c.message+"</p>");e(".overlay, .prompt-box").fadeIn(500)});d.bind("FileUploaded",function(d,g,f){var h=JSON.parse(f.response);d=e("#themify_builder_alert",top_iframe);f="200"!==f.status||h.error?"error":"done";if(h.error)ThemifyBuilderCommon.showLoader(f),alert(h.error);else if(c){var k=e("#themify_builder_row_wrapper").children().clone(!0);d.promise().done(function(){b.Forms.reLoad(h,themifyBuilder.post_ID);var a=e("#themify_builder_row_wrapper").children().clone(!0);ThemifyBuilderCommon.Lightbox.close();
b.vent.trigger("dom:change","","","","import",{before:k,after:a,bid:themifyBuilder.post_ID})})}else ThemifyBuilderCommon.showLoader(f),f=h.large_url?h.large_url:h.url,a.closest(".themify_builder_input").find(".themify-builder-uploader-input").val(f).trigger("change").parent().find(".img-placeholder").html(e("<img/>",{src:h.thumb,width:50,height:50}))});a.removeClass("plupload-clone")})}},columnDrag:function(a,c,d,f){var g=this;c&&(c=a?a.children(".module_column"):e(".module_column"),c.css("width",
""),g.setCompactMode(c));if(d&&f){a=a.children(".module_column");var h=("gutter-narrow"===d?1.6:"gutter-none"===d?0:3.2)-("gutter-narrow"===f?1.6:"gutter-none"===f?0:3.2),h=parseFloat(h*(a.length-1)/a.length);a.each(function(a){e(this).prop("style").width&&(a=parseFloat(e(this).prop("style").width)+h,e(this).css("width",a+"%"))})}else{var k={"col6-1":14,"col5-1":17.44,"col4-1":22.6,"col4-2":48.4,"col2-1":48.4,"col4-3":74.2,"col3-1":31.2,"col3-2":65.6},l={"col6-1":15.33,"col5-1":18.72,"col4-1":23.8,
"col4-2":49.2,"col2-1":49.2,"col4-3":74.539,"col3-1":32.266,"col3-2":66.05},m={"col6-1":16.666,"col5-1":20,"col4-1":25,"col4-2":50,"col2-1":50,"col4-3":75,"col3-1":33.333,"col3-2":66.666};(a?a.children(".module_column").find(".themify_grid_drag"):e(".themify_grid_drag")).each(function(){var a,c,d,f,h=0,z,u=!1,q=0,x=!1,B,A,C,G;e(this).draggable({axis:"x",cursor:"col-resize",distance:0,scroll:!1,snap:!1,containment:".row_inner",helper:function(b){a=e(b.currentTarget);c=a.closest(".subrow_inner");0===
c.length&&(c=a.closest(".row_inner"));z=a.hasClass("themify_drag_right")?"w":"e";B="w"===z?"themify_grid_drag_placeholder_right":"themify_grid_drag_placeholder_left";x=ThemifyBuilderCommon.Lightbox.clone(c.closest(".module_row"));return e('<div class="ui-widget-header themify_grid_drag_placeholder '+B+'"></div><div class="ui-widget-header themify_grid_drag_placeholder"></div>')},start:function(b,e){d=c.children(".module_column");f=a.closest(".module_column");C=c.hasClass("direction-rtl");"w"===z?
(u=C?f.prev(".module_column"):f.next(".module_column"),h=a.outerWidth()):(u=C?f.next(".module_column"):f.prev(".module_column"),h=f.outerWidth());q=u.outerWidth()-2;G=e.position.left;A=c.outerWidth()},stop:function(a,h){e(".themify_grid_drag_placeholder").remove();var n=Math.ceil(100*(f.outerWidth()/A));f.css("width",n+"%");var p=k,n=3.2;c.hasClass("gutter-narrow")?(p=l,n=1.6):c.hasClass("gutter-none")&&(p=m,n=0);var r=n*(d.length-1);d.each(function(a){a!==u.index()&&(e(this).prop("style").width?
a=parseFloat(e(this).prop("style").width):(a=e.trim(g.filterClass(e(this).attr("class")).replace("first","").replace("last","")),a=p[a]),r+=a)});u.css("width",100-r+"%");u=u.add(f);g.setCompactMode(u);n=c.closest(".module_row");b.vent.trigger("dom:change",n.data("cid"),x,n,"row")},drag:function(a,c){if(u&&0<u.length){var b=h+("e"===z?-c.position.left:c.position.left),d=parseFloat(100*b/A);if(5<=d&&100>d){var e=q+G+("w"===z?-c.position.left:c.position.left),k=parseFloat(100*e/A);5<k&&100>k&&(u.css("width",
e+"px"),f.css("width",b+"px").children("."+B).html(d.toFixed(2)+"%"),f.children(".themify_grid_drag_placeholder").last().html(k.toFixed(2)+"%"),g.setCompactMode(f))}}}})})}},setCompactMode:function(a){a instanceof jQuery&&(a=a.get());for(var c=0,b=a.length;c<b;++c){var e=a[c].clientWidth,e=234>e?["compact-mode-action","compact-mode"]:370>e?["compact-mode"]:"";a[c].classList.remove("compact-mode-action");a[c].classList.remove("compact-mode");if(""!==e)for(var g in e)a[c].classList.add(e[g]);if(""===
e||"compact-mode"===e[0])e=a[c].getElementsByClassName("sub_column"),0<e.length&&this.setCompactMode(e)}},initNewEditor:function(a){var c=tinyMCEPreInit.mceInit.tb_lb_hidden_editor;c.elements=a;c.selector="#"+a;return this.initMCEv4(a,c)},initMCEv4:function(a,c){if(3<parseInt(tinyMCE.majorVersion)){var b=new tinyMCE.Editor(a,c,tinyMCE.EditorManager);b.render();return b}},initQuickTags:function(a){"function"===typeof window.parent.QTags&&(window.parent.quicktags({id:a}),window.parent.QTags._buttonsInit())},
setColorPicker:function(a){e(".minicolors-swatch",a).each(function(){var a=e(this),d=a.closest(".minicolors_wrapper");e(this).one("click",function(){var a=d.find(".minicolors-input");d.prepend(a).find(".minicolors").remove();b.hasChanged=!0;b.Views.init_control("color",{el:a,binding_type:a.data("control-binding")})}).prev(".minicolors-input").one("focusin",function(){e(this).next(".minicolors-swatch").trigger("click")});d.find(".color_opacity").one("change",function(){a.prev(".minicolors-input").attr("data-opacity",
e(this).val());a.trigger("click")})})},_getColClass:function(a){for(var c=0,b=a.length;c<b;++c)if(-1!==this.gridClass.indexOf(a[c]))return a[c].replace("col","")},saveBuilder:function(a,c,d,f){c=c||"main";d=d||0;0===d&&("main"===c&&b.activeModel&&e(".builder_save_button",top_iframe).trigger("click"),ThemifyBuilderCommon.showLoader("show"));var g=Object.keys(b.Instances.Builder).length,h=b.Instances.Builder[d],k=this,l=h.$el.data("postid"),h=h.toJSON();(function(a,c,d,g){c={action:"tb_save_data",tb_load_nonce:themifyBuilder.tb_load_nonce,
id:a,data:JSON.stringify(c),tb_saveto:d,sourceEditor:"visual"===b.mode?"frontend":"backend"};g&&(c.only_data=g);return e.ajax({type:"POST",url:themifyBuilder.ajaxurl,cache:!1,data:c})})(l,h,c,f).always(function(f,h){++d;g===d?(e.isFunction(a)&&a.call(k,f,h),"success"!==h?ThemifyBuilderCommon.showLoader("error"):(ThemifyBuilderCommon.showLoader("hide"),b.editing=!0,e("body").trigger("themify_builder_save_data",[f,h]))):setTimeout(function(){k.saveBuilder(a,c,d)},50)})},loadContentJs:function(a,c){ThemifyBuilderModuleJs.loadOnAjax(a,
c);if(!1===b.saving){var d=e(".wp-audio-shortcode, .wp-video-shortcode",a).not(".mejs-container").filter(function(){return!e(this).parent().hasClass("mejs-mediaelement")});if(0<d.length){if(themifyBuilder.media_css){for(var f in themifyBuilder.media_css)Themify.LoadCss(themifyBuilder.media_css[f]);themifyBuilder.media_css=null}d.mediaelementplayer("undefined"!==typeof window.top._wpmejsSettings?window.top._wpmejsSettings:{})}}e("body").trigger("builder_load_module_partial",[a,c])},mediaUploader:function(){var a=
{};e("body",top_iframe).on("click",".themify-builder-media-uploader",function(c){c.preventDefault();c.stopPropagation();var d=e(this),f=d.closest(".themify_builder_input");c=d.data("uploader-title");var g=d.data("uploader-button-text"),d=d.data("library-type")?d.data("library-type"):"image",h=Themify.hash(d+c+g);if(void 0!==a[h])var k=a[h];else k=wp.media.frames.file_frame=wp.media({title:c,library:{type:d},button:{text:g},multiple:!1}),a[h]=k;k.off("select").on("select",function(){var a=k.state().get("selection").first().toJSON();
f.find(".themify-builder-uploader-input").val(a.url).trigger("change").parent().find(".img-placeholder").html(e("<img/>",{src:a.url,width:50,height:50}));b.hasChanged=!0;f.find(".themify-builder-uploader-input-attach-id").val(a.id)});k.open()}).on("click",".themify-builder-delete-thumb",function(a){a.preventDefault();b.hasChanged=!0;e(this).prev().empty().closest(".themify_builder_input").find(".themify-builder-uploader-input").val("").trigger("change")}).on("click",".insert-media",function(a){b.hasChanged=
!0;window.top.wpActiveEditor=e(this).data("editor")})},openGallery:function(){var a=wp.media.gallery.shortcode,c=this,d=null;e("body",top_iframe).on("click",".tb-gallery-btn",function(f){f.preventDefault();var g=e(this).closest(".themify_builder_input").find(".tb-shortcode-input");null===d&&(d=wp.media.frames.file_frame=wp.media({frame:"post",state:"gallery-edit",title:wp.media.view.l10n.editGalleryTitle,editing:!0,multiple:!0,selection:!1}),d.$el.addClass("themify_gallery_settings"));wp.media.gallery.shortcode=
function(c){var b=c.props.toJSON(),d=_.pick(b,"orderby","order");c.gallery&&_.extend(d,c.gallery.toJSON());d.ids=c.pluck("id");b.uploadedTo&&(d.id=b.uploadedTo);d._orderbyRandom&&(d.orderby="rand",delete d._orderbyRandom);d.ids&&"post__in"===d.orderby&&delete d.orderby;_.each(wp.media.gallery.defaults,function(a,c){a===d[c]&&delete d[c]});c=new window.top.wp.shortcode({tag:"gallery",attrs:d,type:"single"});g.val(c.string()).trigger("change");wp.media.gallery.shortcode=a;return c};d.on("update",function(a){var d=
wp.media.gallery.shortcode(a).string().slice(1,-1);g.val("["+d+"]");c.setShortcodePreview(a.models,g);b.hasChanged=!0});0<e.trim(g.val()).length?(d=wp.media.gallery.edit(e.trim(g.val())),d.state("gallery-edit").on("update",function(a){var d=wp.media.gallery.shortcode(a).string().slice(1,-1);g.val("["+d+"]");c.setShortcodePreview(a.models,g);b.hasChanged=!0})):(d.open(),d.$el.find(".media-menu .media-menu-item").last().trigger("click"))})},setShortcodePreview:function(a,c){var b=c.next(".tb_shortcode_preview"),
f="";0===b.length&&(b=e('<div class="tb_shortcode_preview"></div>'),c.after(b));for(var g=0,h=a.length;g<h;++g)var k=a[g].attributes,f=f+('<img src="'+(k.sizes.thumbnail?k.sizes.thumbnail.url:k.url)+'" width="50" height="50" />');b[0].innerHTML=f},createGradientPicker:function(a,c,d){var f=a.closest(".themify-gradient-field"),g=null,h=!1,k=a.data("id"),l=f.find("#"+k+"-gradient-angle"),m=a.prev(),r={angle:l.val(),onChange:function(c,d){h&&(c=d="");"visual"===b.mode&&("cover_gradient"===k||"cover_gradient_hover"===
k?b.liveStylingInstance.addOrRemoveComponentOverlay(k,d):b.liveStylingInstance.bindBackgroundGradient(k,d));a.val(c);themifybuilderapp.hasChanged=!0},onInit:function(){m.show()}};r.gradient=c?c:a.data("default-gradient")?a.data("default-gradient"):void 0;d||m.ThemifyGradient(r);g=a.prev().data("themifyGradient");c=f.find("#"+k+"-gradient-type");var p=f.find("#"+k+"-circle-radial input"),w=function(a){var c=l.parent(".gradient-angle-knob"),b=f.find("#"+k+"-circle-radial");"radial"===a?(c.hide(),c.next("span").hide(),
b.show()):(c.show(),c.next("span").show(),b.hide())};d?(g.settings=e.extend({},g.settings,r),g.settings.type=c.val(),g.settings.circle=p.is(":checked"),g.isInit=!1,g.update(),g.isInit=!0):(f.find(".themify-clear-gradient").on("click",function(a){a.preventDefault();h=!0;g.settings.gradient=e.ThemifyGradient["default"];g.update();h=!1}),c.on("change",function(a){g.setType(e(this).val());w(e(this).val())}),p.on("change",function(){g.setRadialCircle(e(this).is(":checked"))}),l.on("change",function(){var a=
parseInt(e(this).val());a||(a=0);g.setAngle(a)}).knob({change:function(a){g.setAngle(Math.round(a))}}),l.removeAttr("style").parent().addClass("gradient-angle-knob").find("canvas").insertAfter(l));w(c.val())},toRGBA:function(a){var c=a.split("_"),b=/^([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/;return void 0!==c[0]?(b=b.exec(c[0].replace("#","")),c=void 0!==c[1]&&"0.99"!=c[1]?c[1]:1,b?"rgba("+parseInt(b[1],16)+", "+parseInt(b[2],16)+", "+parseInt(b[3],16)+", "+c+")":a):a},getBPWidth:function(a){a=
_.isArray(themifyBuilder.breakpoints[a])?themifyBuilder.breakpoints[a]:themifyBuilder.breakpoints[a].toString().split("-");return a[a.length-1]},transitionPrefix:function(){if(void 0===this.transitionPrefix.pre){var a=document.createElement("fakeelement"),c={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"},b;for(b in c)if(void 0!==a.style[b]){this.transitionPrefix.pre=c[b];break}}return this.transitionPrefix.pre}};_.extend(b.Views.BaseElement.prototype,
b.Mixins.Common);_.extend(b.Views.Builder.prototype,b.Mixins.Builder);b.Views.ControlRegistry={items:{},register:function(a,c){this.items[a]=c},lookup:function(a){return this.items[a]||null},remove:function(a){delete this.items[a]},destroy:function(){_.each(this.items,function(a,c){a.remove()});this.items={}}};b.Views.Controls["default"]=Backbone.View.extend({initialize:function(a){b.Views.ControlRegistry.register(this.$el.prop("id"),this);a.binding_type&&(this.binding_type=a.binding_type);a.selector&&
(this.selector=a.selector)},preview_element:function(a){if(void 0!==this.binding_type){b.hasChanged=!0;var c=this.$el.data("control-type"),d="repeater"===c?this.$el.prop("id"):this.$el.data("control-repeater");if(d&&"visual"===b.mode){var f=e("#"+d,top_iframe);0<f.length&&(x[d]=b.Forms.parseSettings(f[0]).v)}else x[this.$el.prop("id")]=a;"visual"===b.mode?"live"===this.binding_type?b.activeModel.trigger("custom:preview:live",x,"wp_editor"===c||"TEXTAREA"===this.el.tagName,null,this.selector,a,this.$el):
"refresh"===this.binding_type&&b.activeModel.trigger("custom:preview:refresh",x,this.selector,a,this.$el):"module"===b.activeModel.get("elType")&&b.activeModel.backendLivePreview()}}});b.Views.Controls["default"].extend=function(a){var c=this,b=Backbone.View.extend.apply(this,arguments);b.prototype.events=_.extend({},this.prototype.events,a.events);b.prototype.initialize=function(){_.isFunction(c.prototype.initialize)&&c.prototype.initialize.apply(this,arguments);_.isFunction(a.initialize)&&a.initialize.apply(this,
arguments)};return b};b.Views.register_control=function(a,c){"default"!==a&&(this.Controls[a]=this.Controls["default"].extend(c))};b.Views.get_control=function(a){return this.control_exists(a)?this.Controls[a]:this.Controls["default"]};b.Views.control_exists=function(a){return this.Controls.hasOwnProperty(a)};b.Views.init_control=function(a,c){c=c||{};c.binding_type||c.el.hasClass("minicolors-input")||(c.binding_type="refresh");a?"wp_editor"===a&&c.el.hasClass("data_control_binding_live")&&(c.binding_type=
"live"):a="change";var d=c.el.data("input-id");d||(d=c.el.prop("id"));return"wp_editor"!==a&&(d=this.ControlRegistry.lookup(d),null!==d)?(d.setElement(c.el).render(),d):new (b.Views.get_control(a))(c)};b.Views.register_control("wp_editor",{initialize:function(){this.render()},render:function(){var a=this,c="refresh"===this.binding_type&&void 0===this.selector?1E3:50,d=this.$el.prop("id"),f="",c=_.throttle(function(c){c="setupeditor"===this.type?this.getContent():e(this).val();null!==b.activeModel&&
f!==c&&(f=c,!1!==g?a.$el.val(c).trigger("change"):a.preview_element(c))},c);b.Utils.initQuickTags(d);if(void 0!==tinyMCE&&void 0!==this.binding_type){_.isUndefined(tinymce.editors[d])||tinyMCE.execCommand("mceRemoveEditor",!0,d);d=b.Utils.initNewEditor(d);var g=this.$el.hasClass("wp-editor-area")?0<this.$el.closest("#instance_widget").length:!1;d.on("change keyup",c)}this.$el.on("change keyup",c);return this}});b.Views.register_control("change",{initialize:function(){this.render()},render:function(){var a=
this,c="refresh"===this.binding_type&&void 0===this.selector?1E3:50,b=this.$el.data("control-event");if(void 0===b||""===b)b="change",c=1;this.$el.on(b,_.throttle(function(){a.preview_element(this.value)},c));return this}});b.Views.register_control("query_category",{initialize:function(){this.render()},render:function(){var a=this,c=a.$el.parent(),b=c.find(".query_category_single"),f=c.find(".query_category_multiple");b.add(f).on("change",function(c){var d=(c=e(this).hasClass("query_category_single"))?
b.val()+"|single":f.val()+"|multiple";c&&f.val(e(this).val());a.preview_element(d)});return this}});b.Views.register_control("layout",{initialize:function(){this.render()},render:function(){var a=this,c=this.$el.data("input-id"),d=a.$(".tfl-icon.selected").prop("id");c||(c=this.$el.prop("id"));this.$(".tfl-icon").on("click",function(f){f.preventDefault();var g=e(this);f=g.prop("id");g.addClass("selected").siblings().removeClass("selected");if("visual"===b.mode&&"live"===a.binding_type&&void 0!==a.$el.data("control-selector")){var g=
b.liveStylingInstance.$liveStyledElmt,h=b.liveStylingInstance.getStylingVal(c);""!==a.$el.data("control-selector")&&(g=b.liveStylingInstance.$liveStyledElmt.find(a.$el.data("control-selector")));x[c]=f;"layout_feature"===c?(f="layout-"+f,h="layout-"+h):"columns"===c&&(f=c+"-"+f,h=c+"-"+h);!h&&d&&(h=d);g.removeClass(h).addClass(f);"layout_feature"===c?f=f.substr(7):"columns"===c&&(f=f.substr(8));b.liveStylingInstance.setStylingVal(c,f);b.hasChanged=!0}else a.preview_element(f)});return this}});b.Views.register_control("radio",
{initialize:function(){this.render()},render:function(){var a=this;this.$('input[type="radio"]').on("change",function(){a.preview_element(this.value)});return this}});b.Views.register_control("checkbox",{initialize:function(){this.render()},render:function(){var a=this;this.$('input[type="checkbox"]').on("click",function(){if(!_.isUndefined(a.binding_type)){var c=a.$('input[type="checkbox"]:checked').map(function(){return this.value}).get();a.preview_element(c.join("|"))}});return this}});b.Views.register_control("color",
{is_typing:!1,initialize:function(){this.render()},render:function(){var a=this,c=this.$el.next(".color_opacity"),d=this.$el.prop("id");this.$el.minicolors({opacity:1,changeDelay:200,beforeShow:function(){var c=ThemifyBuilderCommon.Lightbox.$lightbox,b=a.$el.closest(".minicolors"),d=b.find(".minicolors-panel");d.css("visibility","hidden").show();c.offset().left+c.width()<=d.offset().left+d.width()?b.addClass("tb-minicolors-right"):b.removeClass("tb-minicolors-right");d.css("visibility","").hide()},
change:function(f,g){f?g&&"0.99"==g&&(g=1):g="";a.is_typing||c.is(":focus")||c.attr("data-opacity",g).data("opacity",g).val(g);var h=f?e(this).minicolors("rgbaString"):"";void 0!==a.binding_type?a.preview_element(h):"visual"===b.mode&&e("body").trigger("themify_builder_color_picker_change",[d,a.$el,f?h:""])}}).minicolors("show");c.on("blur keyup",function(c){var b=parseFloat(e.trim(e(this).val()));if(1<b||isNaN(b)||""===b||0>b)b=a.$el.val()?1:"","blur"===c.type&&e(this).val(b);e(this).attr("data-opacity",
b);a.is_typing="keyup"===c.type;a.$el.minicolors("opacity",b)})}});b.Views.register_control("repeater",{events:{"click .toggle_row":"toggleField","click .themify_builder_duplicate_row":"duplicateRowField","click .themify_builder_delete_row":"deleteRowField"},initialize:function(){this.render()},render:function(){var a=this.$el,c=this,b=!1;a.sortable({items:".tb_repeatable_field",handle:".tb_repeatable_field_top",axis:"y",placeholder:"themify_builder_ui_state_highlight",tolerance:"pointer",cursor:"move",
start:_.debounce(function(b,c){void 0!==tinyMCE&&a.find(".tb_lb_wp_editor").each(function(){var a=e(this).prop("id"),b=tinymce.get(a).getContent();e(this).data("content",b);tinyMCE.execCommand("mceRemoveEditor",!1,a)})},300),stop:_.debounce(function(d,g){void 0!==tinyMCE&&a.find(".tb_lb_wp_editor").each(function(){var a=e(this).prop("id");tinyMCE.execCommand("mceAddEditor",!1,a);tinymce.get(a).setContent(e(this).data("content"))});b&&(g.item.removeClass("collapsed").find(".tb_repeatable_field_content").show(),
b=!1);a.find(".themify_builder_ui_state_highlight").remove();c.preview_element()},300),sort:function(b,c){a.find(".themify_builder_ui_state_highlight").height(30)},beforeStart:function(c,d){d.item.hasClass("collapsed")||(d.item.addClass("collapsed").find(".tb_repeatable_field_content").hide(),b=!0,a.sortable("refresh"))}});return this},toggleField:function(a){a.preventDefault();e(a.currentTarget).closest(".tb_repeatable_field").toggleClass("collapsed").find(".tb_repeatable_field_content").slideToggle()},
duplicateRowField:function(a){a.preventDefault();a.stopPropagation();this.$el.next(".add_new").find("a").trigger("click",e(a.currentTarget).closest(".tb_repeatable_field"));this.preview_element()},deleteRowField:function(a){a.preventDefault();a.stopPropagation();confirm(themifyBuilder.i18n.rowDeleteConfirm)&&(e(a.currentTarget).closest(".tb_repeatable_field").remove(),this.preview_element())}});b.Views.register_control("widget_form",{initialize:function(){this.render()},render:function(){this.$el.on("change",
":input",this._updateWidgetPreview.bind(this));return this},_updateWidgetPreview:function(){this.preview_element(this.$el.find(":input").themifySerializeObject())}})})(jQuery);
