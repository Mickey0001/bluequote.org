/*
 ThemifyGradient
 Enhanced version of ClassyGradient, with RGBA support

 Original script written by Marius Stanciu - Sergiu <marius@vox.space>
 Licensed under the MIT license https://vox.SPACE/LICENSE-MIT
 Version 1.1.1

*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,l,h){a instanceof String&&(a=String(a));for(var m=a.length,f=0;f<m;f++){var n=a[f];if(l.call(h,n,f,a))return{i:f,v:n}}return{i:-1,v:void 0}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,l,h){a!=Array.prototype&&a!=Object.prototype&&(a[l]=h.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,l,h,m){if(l){h=$jscomp.global;a=a.split(".");for(m=0;m<a.length-1;m++){var f=a[m];f in h||(h[f]={});h=h[f]}a=a[a.length-1];m=h[a];l=l(m);l!=m&&null!=l&&$jscomp.defineProperty(h,a,{configurable:!0,writable:!0,value:l})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,h){return $jscomp.findInternal(this,a,h).v}},"es6-impl","es3");
(function(a){a.ThemifyGradient=function(l,h){var m={gradient:a.ThemifyGradient["default"],width:200,height:15,point:8,angle:180,circle:!1,type:"linear",onChange:function(){},onInit:function(){}},f=a(l),n,t,p,v,w,x,y,z,u,q,d=[];this.isInit=!1;this.settings={};this.__constructor=function(){this.settings=a.extend({},m,h);this.update();this.settings.onInit();this.isInit=!0;return this};this.updateSettings=function(c){this.settings=a.extend({},m,c);this.update();return this};this.update=function(){this._setupPoints();
this._setup();this._render()};this.getCSSvalue=function(){var c=this.settings.angle+"deg,";"radial"===this.settings.type&&(c=this.settings.circle?"circle,":"");for(var a=[],b=0,k=d.length;b<k;++b)a.push(d[b][1]+" "+d[b][0]);return this.settings.type+"-gradient("+c+a.join(", ")+")"};this.getString=function(){for(var c="",a=0,b=d.length;a<b;++a)c+=d[a][0]+" "+d[a][1]+"|";return c=c.substr(0,c.length-1)};this.setType=function(a){this.settings.type=a;this.settings.onChange(this.getString(),this.getCSSvalue())};
this.setAngle=function(a){this.settings.angle=a;this.settings.onChange(this.getString(),this.getCSSvalue())};this.setRadialCircle=function(a){this.settings.circle=a;this.settings.onChange(this.getString(),this.getCSSvalue())};this._setupPoints=function(){d=[];d=a.isArray(this.settings.gradient)?this.settings.gradient:this._getGradientFromString(this.settings.gradient)};this._setup=function(){var c=this;n=a('<div class="themifyGradient"></div>');t=a('<canvas class="canvas" width="'+this.settings.width+
'" height="'+this.settings.height+'"></canvas>');n.append(t);u=t[0].getContext("2d");p=a('<div class="points"></div>');p.css("width",this.settings.width+Math.round(this.settings.point/2+1)+"px");n.append(p);v=a('<div class="gradient-pointer-info"></div>');v.append('<div class="gradient-pointer-arrow"></div>');n.append(v);w=a('<div class="content"></div>');v.append(w);x=a('<div class="point-color"><div style="background-color: #00ff00"></div></div>');y=a('<input type="text" class="point-position"/>');
z=a('<a href="#" class="gradient-point-delete"><i class="ti-close"></i></a>');w.append(x,'<span class="gradient_delimiter"></span>',y,'<span class="gradient_percent">%</span>',z);f.html(n);t.off("click").on("click",function(a){var b=t.offset();a=a.pageX-b.left;a=Math.round(100*a/c.settings.width);for(var b="rgba(0,0,0, 1)",g=999999999999,e=0,r=d.length;e<r;++e)d[e][0]=parseInt(d[e][0]),d[e][0]<a&&a-d[e][0]<g?(g=a-d[e][0],b=d[e][1]):d[e][0]>a&&d[e][0]-a<g&&(g=d[e][0]-a,b=d[e][1]);d.push([a+"%",b]);
d.sort(c._sortByPosition);c._render();e=0;for(r=d.length;e<r;++e)d[e][0]===a+"%"&&c._selectPoint(p.find(".point:eq("+e+")"));"visual"===themifybuilderapp.mode&&setTimeout(c._colorPickerPosition,315)});this.pointEvents()};this.pointEvents=function(){var c=this;f.find(".point-position").off("keyup focusout").on("keyup focusout",function(g){var b=parseInt(a.trim(a(this).val()));isNaN(b)?b=0:0>b?b=Math.abs(b):98<=b&&(b=98);"focusout"!==g.type?(b=Math.round(b*c.settings.width/100),a(this).closest(".themifyGradient").find(".themify_current_point").css("left",
b),c._renderCanvas()):a(this).val(b)})};this._render=function(){this._initGradientPoints();this._renderCanvas()};this._colorPickerPosition=function(){var a=ThemifyBuilderCommon.Lightbox.$lightbox,g=w.find(".minicolors"),b=g.find(".minicolors-panel");a.offset().left+a.width()<=b.offset().left+b.width()?g.addClass("tb-minicolors-right"):g.removeClass("tb-minicolors-right")};this._initGradientPoints=function(){var c=this,g="";p.empty();for(var b=0,k=d.length;b<k;++b)g+='<div class="point" style="background-color: '+
d[b][1]+"; left:"+parseInt(d[b][0])*c.settings.width/100+'px;"></div>';p[0].insertAdjacentHTML("afterbegin",g);g=null;p.find(".point").off("click").on("click",function(){c._selectPoint(this);"visual"===themifybuilderapp.mode&&(c._colorPickerPosition(),a(document).trigger("mouseup"))}).draggable({axis:"x",containment:"parent",start:function(a,c){f.addClass("themify_gradient_drag").focus()},stop:function(c,b){f.removeClass("themify_gradient_drag").focus();"visual"===themifybuilderapp.mode&&a(document).trigger("mouseup")},
drag:function(a,b){c._selectPoint(this,!0);c._renderCanvas()}})};this.hexToRgb=function(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,c,e){return b+b+c+c+e+e});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null};this._selectPoint=function(c,g){var b=this;q=a(c);var k=parseInt(q.css("left"));y.val(Math.round(k/this.settings.width*100));k-=30;0>k&&top_iframe.body.classList.contains("tb_module_panel_docked")&&
(k=3);f.find(".gradient-pointer-info").css("marginLeft",k+"px");if(g)return!1;f.focus();q.addClass("themify_current_point").siblings().removeClass("themify_current_point");var e=q.css("backgroundColor"),k=e.substr(4,e.length),k=k.substr(0,k.length-1);f.find(".point-color div").remove();k=x.find(".themify-color-picker");0===k.length&&(k=a('<input type="text" class="themify-color-picker" />'),k.appendTo(x).minicolors({opacity:!0,changeDelay:200,change:function(a,c){var e=b.hexToRgb(a);e||(e={r:255,
g:255,b:255},c=1);q.css("backgroundColor","rgba("+e.r+","+e.g+","+e.b+","+c+")");b._renderCanvas()}}),f.find(".minicolors").first().addClass("minicolors-focus"),z.off("click").on("click",function(a){a.preventDefault();1<d.length&&(d.splice(q.index(),1),b._render())}));var e=e.replace(/^rgba?\(|\s+|\)$/g,"").split(","),r=4===e.length?e.pop():1,e=this._rgbToHex(e);k.val(e).attr("data-opacity",r).data("opacity",r).minicolors("settings",{value:e})};this._renderCanvas=function(){var c=this;d=[];f.find(".point").each(function(){var g=
Math.round(parseInt(a(this).css("left"))/c.settings.width*100);d.push([g+"%",a(this).css("backgroundColor")])});d.sort(c._sortByPosition);this._renderToCanvas();if(this.isInit)this.settings.onChange(this.getString(),this.getCSSvalue())};this._renderToCanvas=function(){for(var a=u.createLinearGradient(0,0,this.settings.width,0),g=0,b=d.length;g<b;++g)a.addColorStop(parseInt(d[g][0])/100,d[g][1]);u.clearRect(0,0,this.settings.width,this.settings.height);u.fillStyle=a;u.fillRect(0,0,this.settings.width,
this.settings.height)};this._getGradientFromString=function(a){var c=[];a=a.split("|");for(var b=0,d=a.length;b<d;++b){var e=a[b];var f=e.indexOf("%");var h=e.substr(f-3,f);"100"===h||"100%"===h?f="100%":(f=1<f?parseInt(e.substr(f-2,f)):parseInt(e.substr(f-1,f)),f+="%");c.push([f,e.replace(f,"")])}return c};this._rgbToHex=function(a){function c(a){a=parseInt(a,10);if(isNaN(a))return"00";a=Math.max(0,Math.min(a,255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)}var b=
a[1],d=a[2];return"#"+c(a[0])+c(b)+c(d)};this._sortByPosition=function(a,d){a=parseInt(a[0]);d=parseInt(d[0]);return a<d?-1:a>d?1:0};return this.__constructor()};a.ThemifyGradient["default"]="0% rgba(0,0,0, 1)|100% rgba(255,255,255,1)";a.fn.ThemifyGradient=function(l){return this.each(function(){void 0===a(this).data("themifyGradient")&&a(this).data("themifyGradient",new a.ThemifyGradient(this,l))})}})(jQuery);
